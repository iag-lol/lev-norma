<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inspección - Red Movilidad</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Variables y configuración base */
        :root {
            /* Colores base - Paleta moderna y profesional */
            --primary: #0066ff;
            --primary-dark: #0047b3;
            --primary-light: #e6f0ff;
            --primary-transparent: rgba(0, 102, 255, 0.1);
            --secondary: #64748b;
            --success: #10b981;
            --success-light: #d1fae5;
            --success-dark: #059669;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --danger-dark: #b91c1c;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --warning-dark: #d97706;
            --info: #0ea5e9;
            --info-light: #e0f2fe;
            --white: #ffffff;
            --light: #f8fafc;
            --light-gray: #e2e8f0;
            --gray: #94a3b8;
            --dark-gray: #475569;
            --dark: #1e293b;
            --black: #020617;

            /* Bordes y sombras */
            --border-radius-sm: 8px;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            --border-radius-full: 9999px;

            --box-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --box-shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --box-shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

            /* Transiciones y animaciones */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);

            /* Fuentes */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;

            /* Espaciado */
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-10: 2.5rem;
            --spacing-12: 3rem;
            --spacing-16: 4rem;

            /* Tamaños de contenedor */
            --container-sm: 640px;
            --container-md: 768px;
            --container-lg: 1024px;
            --container-xl: 1280px;
        }

        /* Tema Oscuro */
        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #1e293b;
            --primary-transparent: rgba(59, 130, 246, 0.2);
            --secondary: #94a3b8;
            --success: #10b981;
            --success-light: #064e3b;
            --success-dark: #34d399;
            --danger: #ef4444;
            --danger-light: #7f1d1d;
            --danger-dark: #f87171;
            --warning: #f59e0b;
            --warning-light: #78350f;
            --warning-dark: #fbbf24;
            --info: #0ea5e9;
            --info-light: #075985;
            --white: #0f172a;
            --light: #1e293b;
            --light-gray: #334155;
            --gray: #64748b;
            --dark-gray: #94a3b8;
            --dark: #e2e8f0;
            --black: #f8fafc;

            --box-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.4);
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --box-shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            --box-shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --box-shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }

        /* Reset base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            font-size: 16px;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size);
            color: var(--dark);
            background-color: var(--light);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: var(--transition);
            height: 100%;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        

        img {
            max-width: 100%;
            height: auto;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Utilidades */
        .container {
            width: 100%;
            padding-left: var(--spacing-4);
            padding-right: var(--spacing-4);
            margin-left: auto;
            margin-right: auto;
            max-width: var(--container-xl);
        }

        .visuallyhidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* Diseño base */
        .app-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100%;
            position: relative;
        }

        /* Header y navegación */
        .header {
            background-image: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: var(--spacing-4) 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.01em;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .app-title i {
            font-size: 1.2em;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--border-radius-full);
            transition: var(--transition);
            font-weight: 500;
            font-size: var(--font-size-sm);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .status-online {
            background-color: var(--success);
            box-shadow: 0 0 6px var(--success);
        }

        .status-offline {
            background-color: var(--danger);
            box-shadow: 0 0 6px var(--danger);
        }

      /* Estadísticas / Contadores - Versión mejorada y responsiva */
.stats-bar {
    background-color: var(--white);
    padding: var(--spacing-3) 0;
    border-bottom: 1px solid var(--light-gray);
    box-shadow: var(--box-shadow-sm);
    /* Cambiado a relative para que avance con el scroll */
    position: relative;
    z-index: 90;
    transition: var(--transition);
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-3);
}

.stat-card {
    background-color: var(--white);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: var(--spacing-3);
    text-align: center;
    transition: var(--transition);
    border: 1px solid transparent;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--box-shadow-md);
    border-color: var(--primary-light);
}

.stat-value {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: var(--spacing-1);
    letter-spacing: -0.02em;
    transition: var(--transition);
}

.stat-complete {
    color: var(--success);
}

.stat-pending {
    color: var(--warning);
}

.stat-damaged {
    color: var(--danger);
}

.stat-label {
    color: var(--secondary);
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

/* Mejorar responsividad para tamaños de pantalla */
@media (max-width: 992px) {
    .stats-container {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-2);
    }
    
    .stat-card {
        padding: var(--spacing-2);
    }
    
    .stat-value {
        font-size: var(--font-size-xl);
    }
}

@media (max-width: 768px) {
    .stats-container {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-2);
    }
    
    .stat-card {
        padding: var(--spacing-2);
    }
}

@media (max-width: 480px) {
    .stats-container {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-1);
    }
    
    .stat-card {
        padding: var(--spacing-2) var(--spacing-1);
    }
    
    .stat-value {
        font-size: var(--font-size-lg);
        margin-bottom: 0;
    }
    
    .stat-label {
        font-size: 10px;
    }
}

.chart-container {
    background-color: var(--white);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: var(--spacing-4);
    margin-top: var(--spacing-4);
    margin-bottom: var(--spacing-4);
    width: 100%;
    height: 250px;
    position: relative;
}

.chart-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    margin-bottom: var(--spacing-4);
    color: var(--dark);
}

/* Tabs - Versión mejorada y que avanza con el scroll */
.tabs-container {
    background-color: var(--white);
    border-bottom: 1px solid var(--light-gray);
    margin-bottom: var(--spacing-4);
    /* Cambiado a relative para que avance con el scroll */
    position: relative;
    z-index: 80;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: var(--transition);
}

.tabs-nav {
    display: flex;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.tabs-nav::-webkit-scrollbar {
    display: none;
}

.tab-item {
    padding: var(--spacing-3) var(--spacing-2);
    white-space: nowrap;
    font-weight: 500;
    color: var(--secondary);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    text-align: center;
    font-size: var(--font-size-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    min-width: 70px;
    gap: var(--spacing-2);
}

.tab-item i {
    font-size: 1.2em;
}

.tab-item::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 3px;
    background-color: transparent;
    transition: var(--transition);
    border-radius: var(--border-radius-full) var(--border-radius-full) 0 0;
}

.tab-item.active {
    color: var(--primary);
    font-weight: 600;
}

.tab-item.active::after {
    background-color: var(--primary);
}

.tab-item:hover {
    color: var(--primary);
    background-color: var(--primary-transparent);
}

/* Ajustes responsivos adicionales para tabs */
@media (max-width: 768px) {
    .tab-item {
        padding: var(--spacing-2) var(--spacing-1);
        font-size: var(--font-size-xs);
        min-width: 60px;
    }
    
    .tab-item i {
        margin-right: 0;
    }
}

@media (max-width: 480px) {
    .tabs-nav {
        justify-content: space-between;
    }
    
    .tab-item {
        padding: var(--spacing-2) var(--spacing-1);
        flex-direction: column;
        gap: var(--spacing-1);
        font-size: 10px;
    }
    
    .tab-item i {
        font-size: 1.4em;
    }
}


        /* Contenido y páginas */
        .main-content {
            flex: 1;
            padding: var(--spacing-4) 0 var(--spacing-8);
            transition: var(--transition);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tarjetas */
        .card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-6);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--light-gray);
        }

        .card:hover {
            box-shadow: var(--box-shadow-md);
        }

        .card-header {
            padding: var(--spacing-4) var(--spacing-6);
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--white);
            transition: var(--transition);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin: 0;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .card-title i {
            color: var(--primary);
        }

        .card-body {
            padding: var(--spacing-6);
            transition: var(--transition);
        }

        /* Formularios */
        .form-group {
            margin-bottom: var(--spacing-4);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-2);
            font-weight: 500;
            color: var(--dark-gray);
            font-size: var(--font-size-sm);
            transition: var(--transition);
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-3) var(--spacing-4);
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: var(--font-size);
            transition: var(--transition);
            background-color: var(--white);
            color: var(--dark);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-shadow: var(--box-shadow-sm);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-transparent);
        }

        .form-control[readonly] {
            background-color: var(--light);
            cursor: not-allowed;
        }

        select.form-control {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px;
            padding-right: 2.5rem;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -0.5rem var(--spacing-4);
        }

        .form-col {
            flex: 1;
            min-width: 250px;
            padding: 0 0.5rem;
        }

        .form-text {
            margin-top: var(--spacing-1);
            font-size: var(--font-size-xs);
            color: var(--gray);
        }

        /* Secciones de normas */
        .norms-section {
            margin-bottom: var(--spacing-6);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-4);
            padding-bottom: var(--spacing-2);
            border-bottom: 1px solid var(--light-gray);
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -1px;
            width: 60px;
            height: 3px;
            background-color: var(--primary);
            border-radius: var(--border-radius-full);
        }

        .section-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .section-title i {
            color: var(--primary);
        }

        .section-actions {
            display: flex;
            gap: var(--spacing-2);
        }

        .norms-grid {
            display: grid;
            gap: var(--spacing-4);
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .norm-card {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-4);
            transition: var(--transition);
            border: 1px solid var(--light-gray);
            position: relative;
            overflow: hidden;
        }

        .norm-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-md);
        }

        .norm-card.unanswered {
            border-left: 3px solid var(--warning);
        }

        .norm-card.pending {
            border-left: 3px solid var(--danger);
        }

        .norm-card.installed {
            border-left: 3px solid var(--success);
        }

        .norm-card.damaged {
            border-left: 3px solid var(--warning-dark);
        }

        .norm-card.not-applicable {
            border-left: 3px solid var(--gray);
            opacity: 0.8;
        }

        .norm-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-3);
        }

        .norm-title {
            font-weight: 600;
            font-size: var(--font-size);
            color: var(--dark);
            margin-right: var(--spacing-2);
            transition: var(--transition);
            line-height: 1.4;
            flex: 1;
        }

        .norm-actions {
            display: flex;
            gap: var(--spacing-1);
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary);
            width: 32px;
            height: 32px;
            border-radius: var(--border-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: var(--font-size);
            background-color: var(--primary-light);
            border: 1px solid transparent;
            padding: 0;
        }

        .btn-icon:hover {
            background-color: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .btn-icon:active {
            transform: scale(0.95);
        }

        /* Opciones de estado */
        .status-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-2);
        }

        @media (min-width: 400px) {
            .status-options {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .status-option {
            padding: var(--spacing-2);
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: var(--font-size-xs);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-1);
            background-color: var(--white);
            color: var(--dark-gray);
            min-height: 36px;
            position: relative;
            overflow: hidden;
        }

        .status-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .status-option i {
            font-size: 1.2em;
        }

        .status-option[data-status="Instalada"] {
            border-color: var(--success-light);
            color: var(--success-dark);
        }

        .status-option[data-status="Pendiente"] {
            border-color: var(--danger-light);
            color: var(--danger-dark);
        }

        .status-option[data-status="Dañada"] {
            border-color: var(--warning-light);
            color: var(--warning-dark);
        }

        .status-option[data-status="No Corresponde"] {
            border-color: var(--gray);
            color: var(--gray);
        }

        .status-option[data-status="Instalada"].selected {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
        }

        .status-option[data-status="Pendiente"].selected {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .status-option[data-status="Dañada"].selected {
            background-color: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .status-option[data-status="No Corresponde"].selected {
            background-color: var(--gray);
            color: white;
            border-color: var(--gray);
        }

        /* Botones */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-2);
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 2px solid transparent;
            padding: var(--spacing-3) var(--spacing-6);
            font-size: var(--font-size);
            line-height: 1.5;
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            transition: transform 0.5s, opacity 0.5s;
            pointer-events: none;
        }

        .btn:active::after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.3;
            transition: 0s;
        }

        .btn-block {
            display: flex;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: var(--box-shadow-sm);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-outline {
            background-color: transparent;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-outline:active {
            transform: translateY(0);
        }

        .btn-success {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-dark);
            border-color: var(--success-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-dark);
            border-color: var(--danger-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-warning {
            background-color: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: var(--warning-dark);
            border-color: var(--warning-dark);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            padding: var(--spacing-2) var(--spacing-4);
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-size: var(--font-size-sm);
            font-weight: 500;
            background-color: var(--primary-light);
            color: var(--primary);
            border: none;
            cursor: pointer;
        }

        .btn-icon-text:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        /* Botones de acción */
        .action-bar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-6);
        }

        .action-bar .btn {
            flex: 1;
            min-width: 180px;
        }

        /* Barra de búsqueda */
        .search-bar {
            margin-bottom: var(--spacing-6);
            display: flex;
            gap: var(--spacing-4);
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 2;
            min-width: 250px;
            position: relative;
        }

        .search-input-wrapper i {
            position: absolute;
            left: var(--spacing-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            pointer-events: none;
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-3) var(--spacing-3) var(--spacing-3) var(--spacing-10);
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: var(--font-size);
            transition: var(--transition);
            background-color: var(--white);
            color: var(--dark);
            box-shadow: var(--box-shadow-sm);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-transparent);
        }

        .filter-select {
            flex: 1;
            min-width: 180px;
        }

        /* Tablas */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-6);
            background-color: var(--white);
            border: 1px solid var(--light-gray);
        }

        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            table-layout: fixed;
        }

        .table th,
        .table td {
            padding: var(--spacing-4);
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
            transition: var(--transition);
        }

        .table th {
            background-color: var(--light);
            font-weight: 600;
            color: var(--dark-gray);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover td {
            background-color: var(--primary-light);
        }

        .table-action-cell {
            width: 120px;
            text-align: center;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
            padding: var(--spacing-1) var(--spacing-3);
            border-radius: var(--border-radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
            line-height: 1.4;
            letter-spacing: 0.03em;
            white-space: nowrap;
            text-transform: uppercase;
            box-shadow: var(--box-shadow-sm);
        }

        .badge-success {
            background-color: var(--success-light);
            color: var(--success-dark);
        }

        .badge-warning {
            background-color: var(--warning-light);
            color: var(--warning-dark);
        }

        .badge-danger {
            background-color: var(--danger-light);
            color: var(--danger-dark);
        }

        .badge-info {
            background-color: var(--info-light);
            color: var(--info);
        }

        .badge-secondary {
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }

        .badge i {
            font-size: 1.1em;
        }

        /* Listas */
        .bus-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .bus-item {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-4) var(--spacing-6);
            margin-bottom: var(--spacing-4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--light-gray);
            position: relative;
            overflow: hidden;
        }

        .bus-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-md);
            border-color: var(--primary-light);
        }

        .bus-item.complete {
            border-left: 4px solid var(--success);
        }

        .bus-item.pending {
            border-left: 4px solid var(--warning);
        }

        .bus-item.damaged {
            border-left: 4px solid var(--danger);
        }

        .bus-info {
            flex: 1;
        }

        .bus-ppu {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-1);
            color: var(--dark);
            transition: var(--transition);
        }

        .bus-details {
            color: var(--secondary);
            font-size: var(--font-size-sm);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-3);
        }

        .bus-detail-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .bus-detail-item i {
            color: var(--primary);
            font-size: 1.1em;
        }

        .bus-status {
            margin-left: var(--spacing-4);
            flex-shrink: 0;
        }

        /* Estado vacío */
        .empty-state {
            padding: var(--spacing-10) var(--spacing-4);
            text-align: center;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: var(--spacing-6);
            transition: var(--transition);
            border: 1px dashed var(--light-gray);
        }

        .empty-icon {
            font-size: var(--font-size-4xl);
            color: var(--light-gray);
            margin-bottom: var(--spacing-4);
            transition: var(--transition);
        }

        .empty-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-2);
            transition: var(--transition);
        }

        .empty-message {
            color: var(--gray);
            max-width: 500px;
            margin: 0 auto;
            font-size: var(--font-size);
            transition: var(--transition);
        }

        /* Modales */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
            overflow-y: auto;
            padding: var(--spacing-4);
        }

        .modal-dialog {
            background-color: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-xl);
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
            animation: modalSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: var(--transition);
            margin: auto;
            overflow: hidden;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(30px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            padding: var(--spacing-4) var(--spacing-6);
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--white);
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            line-height: 1;
            padding: var(--spacing-2);
            cursor: pointer;
            color: var(--gray);
            border-radius: var(--border-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            width: 40px;
            height: 40px;
        }

        .modal-close:hover {
            background-color: var(--light);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: var(--spacing-6);
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: var(--spacing-4) var(--spacing-6);
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-3);
            background-color: var(--white);
        }

        /* Modal para imágenes */
        .image-modal .modal-body {
            padding: 0;
            text-align: center;
        }

        .image-modal .modal-dialog {
            max-width: 800px;
        }

        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        .image-caption {
            padding: var(--spacing-4);
            color: var(--dark-gray);
            font-size: var(--font-size-sm);
            text-align: center;
        }

        /* Resumen de buses */
        .bus-summary {
            margin-bottom: var(--spacing-6);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-4);
        }

        .summary-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--dark);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .summary-date {
            color: var(--secondary);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .summary-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-6);
        }

        .summary-item {
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: var(--spacing-4);
            border: 1px solid var(--light-gray);
        }

        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--secondary);
            margin-bottom: var(--spacing-1);
        }

        .summary-value {
            font-size: var(--font-size);
            font-weight: 600;
            color: var(--dark);
        }

        .status-chart {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-6);
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--spacing-4);
            align-items: center;
        }

        .status-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-3);
        }

        .status-stat-item {
            padding: var(--spacing-3);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .status-stat-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-1);
        }

        .status-stat-label {
            font-size: var(--font-size-xs);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .installed-stat {
            background-color: var(--success-light);
            color: var(--success-dark);
        }

        .pending-stat {
            background-color: var(--danger-light);
            color: var(--danger-dark);
        }

        .damaged-stat {
            background-color: var(--warning-light);
            color: var(--warning-dark);
        }

        .not-applicable-stat {
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }

        .norms-status-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .norm-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3);
            border-bottom: 1px solid var(--light-gray);
        }

        .norm-status-item:last-child {
            border-bottom: none;
        }

        .norm-status-name {
            font-weight: 500;
            color: var(--dark);
            flex: 1;
        }

        /* Paginación */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            list-style: none;
            padding: 0;
            margin: var(--spacing-6) 0;
            gap: var(--spacing-1);
        }

        .page-item {
            margin: 0;
        }

        .page-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            border: 1px solid var(--light-gray);
            background-color: var(--white);
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .page-link:hover {
            background-color: var(--primary-light);
            color: var(--primary);
            border-color: var(--primary-light);
        }

        .page-item.active .page-link {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .page-item.disabled .page-link {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Toast y notificaciones */
        .toast-container {
            position: fixed;
            right: var(--spacing-6);
            bottom: var(--spacing-6);
            z-index: 2100;
            max-width: 100%;
            width: 370px;
            overflow: hidden;
        }

        .toast {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            margin-top: var(--spacing-4);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            position: relative;
            overflow: hidden;
            border-left: 4px solid var(--primary);
            max-width: 100%;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.info {
            border-left-color: var(--info);
        }

        .toast-icon {
            padding: var(--spacing-4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--info);
        }

        .toast-content {
            padding: var(--spacing-4);
            flex: 1;
            min-width: 0;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: var(--spacing-1);
            color: var(--dark);
            font-size: var(--font-size);
        }

        .toast-message {
            color: var(--dark-gray);
            font-size: var(--font-size-sm);
            word-break: break-word;
        }

        .toast-actions {
            padding: var(--spacing-3);
            display: flex;
            align-items: flex-start;
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            width: 30px;
            height: 30px;
            border-radius: var(--border-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: var(--font-size);
        }

        .toast-close:hover {
            background-color: var(--light);
            color: var(--danger);
            transform: rotate(90deg);
        }

        /* Cargador / Loader */
        .loader-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 2500;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease-out;
        }

        .loader {
            position: relative;
            width: 50px;
            height: 50px;
        }

        .loader-circle {
            position: absolute;
            top: 0;
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loader-circle:nth-child(2) {
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            width: 40px;
            height: 40px;
            animation-duration: 1.2s;
            border-top-color: var(--success);
        }

        .loader-circle:nth-child(3) {
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            width: 30px;
            height: 30px;
            animation-duration: 1.5s;
            border-top-color: var(--warning);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loader-text {
            margin-top: var(--spacing-4);
            color: white;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-align: center;
        }

        /* Botón de flotante tema */
        .theme-toggle {
            position: fixed;
            bottom: var(--spacing-6);
            left: var(--spacing-6);
            width: 56px;
            height: 56px;
            border-radius: var(--border-radius-full);
            background-image: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--box-shadow-md);
            z-index: 90;
            border: none;
            font-size: var(--font-size-lg);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        /* Footer */
        .app-footer {
            background-color: var(--white);
            padding: var(--spacing-6) 0;
            border-top: 1px solid var(--light-gray);
            margin-top: auto;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-info {
            color: var(--secondary);
            font-size: var(--font-size-sm);
        }

        .footer-links {
            display: flex;
            gap: var(--spacing-4);
        }

        .footer-link {
            color: var(--secondary);
            font-size: var(--font-size-sm);
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary);
        }

        /* Adaptaciones responsivas */
        @media (max-width: 768px) {
            .container {
                padding-left: var(--spacing-3);
                padding-right: var(--spacing-3);
            }

            .header {
                padding: var(--spacing-3) 0;
            }

            .app-title {
                font-size: var(--font-size-lg);
            }

            .stats-bar {
                top: 20px;
            }

            .stats-container {
                flex-direction: column;
                gap: var(--spacing-3);
            }

            .stat-card {
                width: 100%;
            }

            .tabs-container {
                top: 20px;
            }

            .tab-item {
                padding: var(--spacing-3) var(--spacing-2);
                min-width: auto;
                font-size: var(--font-size-xs);
            }

            .norms-grid {
                grid-template-columns: 1fr;
            }

            .form-col {
                min-width: 100%;
            }

            .search-bar {
                flex-direction: column;
                gap: var(--spacing-3);
            }

            .search-input-wrapper,
            .filter-select {
                width: 100%;
                min-width: 100%;
            }

            .status-chart {
                grid-template-columns: 1fr;
            }

            .theme-toggle {
                bottom: var(--spacing-4);
                left: var(--spacing-4);
                width: 48px;
                height: 48px;
                font-size: var(--font-size);
            }

            .footer-content {
                flex-direction: column;
                gap: var(--spacing-4);
                text-align: center;
            }

            .footer-links {
                justify-content: center;
                flex-wrap: wrap;
                gap: var(--spacing-3);
            }

            .modal-dialog {
                margin: 0;
                max-height: 100vh;
                border-radius: 0;
                width: 100%;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .norms-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media print {

            .header,
            .stats-bar,
            .tabs-container,
            .footer,
            .theme-toggle,
            .toast-container,
            .action-bar,
            .search-bar,
            button:not(.print-include) {
                display: none !important;
            }

            .container {
                width: 100%;
                max-width: none;
                padding: 0;
                margin: 0;
            }

            .main-content {
                padding: 0;
            }

            .card,
            .bus-item,
            .empty-state,
            .table-responsive,
            .norm-card {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
                break-inside: avoid;
            }

            .page {
                display: block !important;
                page-break-after: always;
            }

            .print-page-break {
                page-break-before: always;
            }

            body {
                background-color: white;
                color: black;
                font-size: 12pt;
            }
        }
    </style>
</head>

<body>
    <div class="app-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1 class="app-title"><i class="fas fa-bus"></i> Sistema de Inspección</h1>
                    <div class="status-pill">
                        <div class="status-indicator status-online" id="status-dot"></div>
                        <span id="status-text">Conectado</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Barra de estadísticas -->
        <div class="stats-bar">
            <div class="container">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value stat-complete" id="completed-count">0</div>
                        <div class="stat-label">Buses Completos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value stat-pending" id="pending-count">0</div>
                        <div class="stat-label">Buses Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value stat-damaged" id="damaged-count">0</div>
                        <div class="stat-label">Buses con Daños</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">Total Buses</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs de navegación -->
        <div class="tabs-container">
            <div class="container">
                <nav class="tabs-nav">
                    <div class="tab-item active" data-tab="form">
                        <i class="fas fa-clipboard-list"></i> Formulario
                    </div>
                    <div class="tab-item" data-tab="history">
                        <i class="fas fa-history"></i> Historial
                    </div>
                    <div class="tab-item" data-tab="complete">
                        <i class="fas fa-check-circle"></i> Completos
                    </div>
                    <div class="tab-item" data-tab="pending">
                        <i class="fas fa-exclamation-circle"></i> Pendientes
                    </div>
                    <div class="tab-item" data-tab="reports">
                        <i class="fas fa-chart-bar"></i> Informes
                    </div>
                </nav>
            </div>
        </div>

        <!-- Contenido principal -->
        <main class="main-content">
            <div class="container">
                <!-- PÁGINA DE FORMULARIO -->
                <div class="page active" id="form-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-clipboard-check"></i> Formulario de Inspección</h2>
                        </div>
                        <div class="card-body">
                            <form id="inspection-form">
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="ppu">PPU (Patente)</label>
                                            <input type="text" class="form-control" id="ppu" name="ppu" required
                                                placeholder="Ingrese patente" list="ppu-list">
                                            <datalist id="ppu-list"></datalist>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="terminal">Terminal</label>
                                            <select class="form-control" id="terminal" name="terminal" required>
                                                <option value="">Seleccione Terminal</option>
                                                <option value="EL ROBLE">EL ROBLE</option>
                                                <option value="LA REINA">LA REINA</option>
                                                <option value="MARIA ANGELICA">MARIA ANGELICA</option>
                                                <option value="EL DESCANSO">EL DESCANSO</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="clase">Clase</label>
                                            <input type="text" class="form-control" id="clase" name="clase" readonly>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="marca">Marca</label>
                                            <input type="text" class="form-control" id="marca" name="marca" readonly>
                                        </div>
                                    </div>
                                </div>

                                <div class="norms-section">
                                    <div class="section-header">
                                        <h3 class="section-title"><i class="fas fa-tasks"></i> Lista de Normas Gráficas
                                        </h3>
                                        <div class="section-actions">
                                            <button type="button" class="btn-icon-text" id="collapse-all">
                                                <i class="fas fa-compress-alt"></i> Contraer Todo
                                            </button>
                                            <button type="button" class="btn-icon-text" id="expand-all">
                                                <i class="fas fa-expand-alt"></i> Expandir Todo
                                            </button>
                                        </div>
                                    </div>

                                    <div class="norms-grid" id="norms-container">
                                        <!-- Las normas se agregarán dinámicamente aquí -->
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="fecha">Fecha y Hora</label>
                                    <input type="text" class="form-control" id="fecha" name="fecha" readonly>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="observaciones">Observaciones</label>
                                    <textarea class="form-control" id="observaciones" name="observaciones" rows="3"
                                        placeholder="Ingrese observaciones adicionales"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block">
                                    <i class="fas fa-save"></i> Registrar Inspección
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA DE HISTORIAL -->
                <div class="page" id="history-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-history"></i> Historial de Revisiones</h2>
                        </div>
                        <div class="card-body">
                            <div class="search-bar">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="search-input" id="history-search"
                                        placeholder="Buscar por patente...">
                                </div>
                                <select class="form-control filter-select" id="history-filter">
                                    <option value="all">Todos los estados</option>
                                    <option value="completed">Completos</option>
                                    <option value="pending">Pendientes</option>
                                    <option value="damaged">Con daños</option>
                                </select>
                            </div>

                            <div class="table-responsive">
                                <table class="table" id="history-table">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>PPU</th>
                                            <th>Terminal</th>
                                            <th>Estado</th>
                                            <th class="table-action-cell">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="history-list">
                                        <!-- El historial se agregará dinámicamente aquí -->
                                    </tbody>
                                </table>
                            </div>

                            <div id="history-empty" class="empty-state" style="display: none;">
                                <div class="empty-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <h3 class="empty-title">No hay registros de inspección</h3>
                                <p class="empty-message">Las inspecciones realizadas aparecerán aquí.</p>
                            </div>

                            <nav aria-label="Paginación de historial">
                                <ul class="pagination" id="history-pagination">
                                    <!-- La paginación se generará dinámicamente -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA DE BUSES COMPLETOS -->
                <div class="page" id="complete-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-check-circle"></i> Buses Completos</h2>
                        </div>
                        <div class="card-body">
                            <div class="search-bar">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="search-input" id="complete-search"
                                        placeholder="Buscar por patente...">
                                </div>
                                <select class="form-control filter-select" id="complete-filter">
                                    <option value="all">Todas las marcas</option>
                                    <option value="Scania">Scania</option>
                                    <option value="Volvo">Volvo</option>
                                </select>
                            </div>

                            <ul class="bus-list" id="complete-buses-list">
                                <!-- Los buses completos se agregarán dinámicamente aquí -->
                            </ul>

                            <div id="complete-empty" class="empty-state" style="display: none;">
                                <div class="empty-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <h3 class="empty-title">No hay buses completos</h3>
                                <p class="empty-message">Los buses que tengan todas las normas instaladas o marcadas
                                    como "No corresponde" aparecerán aquí.</p>
                            </div>

                            <nav aria-label="Paginación de buses completos">
                                <ul class="pagination" id="complete-pagination">
                                    <!-- La paginación se generará dinámicamente -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA DE BUSES PENDIENTES -->
                <div class="page" id="pending-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-exclamation-circle"></i> Buses Pendientes</h2>
                        </div>
                        <div class="card-body">
                            <div class="action-bar">
                                <button class="btn btn-outline" id="export-pdf">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                                <button class="btn btn-outline" id="export-excel">
                                    <i class="fas fa-file-excel"></i> Exportar Excel
                                </button>
                                <button class="btn btn-outline" id="send-report">
                                    <i class="fas fa-paper-plane"></i> Enviar Informe
                                </button>
                            </div>

                            <div class="search-bar">
                                <div class="search-input-wrapper">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="search-input" id="pending-search"
                                        placeholder="Buscar por patente...">
                                </div>
                                <select class="form-control filter-select" id="pending-filter">
                                    <option value="all">Todas las normas</option>
                                    <option value="class-b">Clase B</option>
                                    <option value="class-c">Clase C</option>
                                </select>
                            </div>

                            <div class="table-responsive">
                                <table class="table" id="pending-table">
                                    <thead>
                                        <tr>
                                            <th>PPU</th>
                                            <th>Clase</th>
                                            <th>Norma Pendiente</th>
                                            <th>Estado</th>
                                            <th class="table-action-cell">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pending-list">
                                        <!-- Los buses pendientes se agregarán dinámicamente aquí -->
                                    </tbody>
                                </table>
                            </div>

                            <div id="pending-empty" class="empty-state" style="display: none;">
                                <div class="empty-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 class="empty-title">No hay buses pendientes</h3>
                                <p class="empty-message">Los buses con normas pendientes o dañadas aparecerán aquí.</p>
                            </div>

                            <nav aria-label="Paginación de buses pendientes">
                                <ul class="pagination" id="pending-pagination">
                                    <!-- La paginación se generará dinámicamente -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA DE INFORMES -->
                <div class="page" id="reports-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-chart-bar"></i> Informes y Estadísticas</h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <h3 class="chart-title">Estado General de la Flota</h3>
                                <canvas id="fleet-status-chart"></canvas>
                            </div>

                            <div class="chart-container">
                                <h3 class="chart-title">Top 5 Normas Pendientes</h3>
                                <canvas id="pending-norms-chart"></canvas>
                            </div>

                            <div class="chart-container">
                                <h3 class="chart-title">Progreso por Terminal</h3>
                                <canvas id="terminal-progress-chart"></canvas>
                            </div>

                            <div class="chart-container">
                                <h3 class="chart-title">Comparativa por Clase de Bus</h3>
                                <canvas id="class-comparison-chart"></canvas>
                            </div>

                            <div class="action-bar">
                                <button class="btn btn-outline" id="generate-complete-report">
                                    <i class="fas fa-file-alt"></i> Generar Informe Completo
                                </button>
                                <button class="btn btn-outline" id="export-charts">
                                    <i class="fas fa-images"></i> Exportar Gráficos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-info">
                        Sistema de Inspección Red Movilidad &copy; 2025
                    </div>
                    <div class="footer-links">
                        <a href="#" class="footer-link">Ayuda</a>
                        <a href="#" class="footer-link">Manual de Usuario</a>
                        <a href="#" class="footer-link">Contacto</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Modal de Detalles del Bus -->
        <div class="modal-backdrop" id="detail-modal-backdrop">
            <div class="modal-dialog" id="detail-modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="modal-title">Detalles del Bus</h3>
                    <button type="button" class="modal-close" id="modal-close" aria-label="Cerrar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- El contenido se agregará dinámicamente -->
                </div>
                <div class="modal-footer" id="modal-footer">
                    <button type="button" class="btn btn-outline" id="modal-close-btn">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" id="modal-edit-btn">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button type="button" class="btn btn-success" id="modal-print-btn">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Imágenes -->
        <div class="modal-backdrop" id="image-modal-backdrop">
            <div class="modal-dialog image-modal" id="image-modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="image-modal-title">Vista Previa</h3>
                    <button type="button" class="modal-close" id="image-modal-close" aria-label="Cerrar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="image-modal-body">
                    <img id="preview-image" class="modal-image" src="" alt="Vista previa de la norma">
                    <div class="image-caption" id="image-caption"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="image-modal-close-btn">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- Contenedor de Toast -->
        <div class="toast-container" id="toast-container">
            <!-- Los toast se agregarán dinámicamente -->
        </div>

        <!-- Cargador -->
        <div class="loader-backdrop" id="loader">
            <div>
                <div class="loader">
                    <div class="loader-circle"></div>
                    <div class="loader-circle"></div>
                    <div class="loader-circle"></div>
                </div>
                <div class="loader-text">Procesando...</div>
            </div>
        </div>

        <!-- Botón de Tema -->
        <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    <script>

        // Configuración de Supabase
        const SUPABASE_URL = 'https://tcmtxvuucjttngcazgff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbXR4dnV1Y2p0dG5nY2F6Z2ZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MjUwMDEsImV4cCI6MjA1NjMwMTAwMX0.2WcIjMUEhSM6j9kYpbsYArQocZdHx86k7wXk-NyjIs0';
        let supabaseClient = null;

        // Estado de la aplicación
        let currentBusData = null;
        let inspectionData = [];
        let isEditMode = false;
        let editInspectionIndex = -1;
        let isConnected = false;
        let currentPage = {
            history: 1,
            complete: 1,
            pending: 1
        };
        const PAGE_SIZE = 10;

        // Opciones de estado para normas
        const statusOptions = ["Instalada", "Pendiente", "Dañada", "No Corresponde"];

        // Un solo evento DOMContentLoaded para toda la inicialización
        document.addEventListener("DOMContentLoaded", function () {
            // Iniciamos la aplicación
            initializeAppSafely();


        });

        // Función segura de inicialización que maneja errores
        function initializeAppSafely() {
            // Usamos una función async auto-ejecutada para poder usar await
            (async function () {
                try {
                    // Inicializar cliente Supabase
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

                    // Intentamos conectarnos primero, para ver si ya existen las tablas
                    try {
                        const { data, error } = await supabaseClient
                            .from('inspecciones')
                            .select('*')
                            .limit(1);

                        // Si no hay error, estamos conectados y las tablas existen
                        isConnected = true;
                        updateConnectionStatus(true);
                        showToast('success', 'Conexión Exitosa', 'Conectado correctamente a la base de datos');
                    } catch (connectionError) {
                        // Si hay error, intentamos crear las tablas
                        console.log("Tablas no encontradas, intentando crearlas:", connectionError);

                        try {
                            // Intentamos crear las tablas requeridas
                            const tablesCreated = await initializeDatabase();

                            if (tablesCreated) {
                                isConnected = true;
                                updateConnectionStatus(true);
                            } else {
                                throw new Error("No se pudieron crear las tablas");
                            }
                        } catch (dbError) {
                            // Si falla la creación de tablas, trabajamos en modo offline
                            console.error("Error al crear tablas:", dbError);
                            isConnected = false;
                            updateConnectionStatus(false);
                            showToast('warning', 'Modo Offline', 'Trabajando en modo local. Los datos se guardarán en este dispositivo.');
                        }
                    }

                    // Inicializar componentes de la interfaz (esto sucede independientemente del estado de conexión)
                    initializeThemeToggle();
                    populatePPUDatalist();
                    updateDateTimeField();
                    setInterval(updateDateTimeField, 60000);
                    initializeTabSystem();
                    initializeFormHandling();
                    initializeModals();
                    initializeImagePreview();
                    initializeFilters();
                    initializeExportButtons();
                    initializePrintFunctionality();
                    initializeCharts();

                    // Cargar datos iniciales (funcionará en modo offline si es necesario)
                    await loadInspectionData();

                    // Verificar conexión periódicamente
                    setInterval(checkConnection, 30000);

                } catch (error) {
                    // Error general de inicialización
                    console.error("Error fatal al inicializar la aplicación:", error);
                    showToast('error', 'Error de Inicialización', 'Ocurrió un problema al inicializar la aplicación.');

                    // Aún así, intentamos inicializar la UI básica para no quedar completamente bloqueados
                    try {
                        initializeThemeToggle();
                        initializeTabSystem();
                    } catch (e) {
                        console.error("No se pudo inicializar la interfaz mínima:", e);
                    }
                }
            })();
        }


        // Función para inicializar la base de datos
        async function initializeDatabase() {
            try {
                showLoader('Inicializando base de datos...');

                if (!supabaseClient) {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                }

                // Implementación simple para verificar y crear tablas
                let success = false;

                try {
                    // Primero probamos el método SQL directo
                    success = await createTablesDirectly();
                } catch (sqlError) {
                    console.error("Error al crear tablas directamente:", sqlError);

                    try {
                        // Si falla, intentamos con la función RPC
                        success = await createTablesViaRPC();
                    } catch (rpcError) {
                        console.error("Error al crear tablas via RPC:", rpcError);
                        throw new Error("No se pudieron crear las tablas por ningún método");
                    }
                }

                if (!success) {
                    throw new Error("No se pudo verificar la creación de tablas");
                }

                return true;
            } catch (error) {
                console.error('Error al inicializar la base de datos:', error);
                showToast('error', 'Error de inicialización', 'No se pudo inicializar la base de datos: ' + error.message);
                return false;
            } finally {
                hideLoader();
            }
        }

        // Verificar conexión a Supabase
        async function checkConnection() {
            try {
                if (!supabaseClient) return;

                const { data, error } = await supabaseClient
                    .from('inspecciones')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                // Si estábamos desconectados y ahora conectados, recargar datos
                if (!isConnected) {
                    isConnected = true;
                    updateConnectionStatus(true);
                    showToast('success', 'Conexión Restablecida', 'La conexión a la base de datos ha sido restablecida');
                    await loadInspectionData();
                } else {
                    isConnected = true;
                }
            } catch (error) {
                if (isConnected) {
                    isConnected = false;
                    updateConnectionStatus(false);
                    showToast('error', 'Conexión Perdida', 'Se ha perdido la conexión a la base de datos. Trabajando en modo local.');
                }
            }
        }

        // Actualizar indicador de estado de conexión
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');

            if (connected) {
                statusDot.className = 'status-indicator status-online';
                statusText.textContent = 'Conectado';
            } else {
                statusDot.className = 'status-indicator status-offline';
                statusText.textContent = 'Desconectado';
            }
        }

        // Inicializar toggle del tema
        function initializeThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('i');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // Verificar si hay un tema guardado o usar la preferencia del sistema
            const currentTheme = localStorage.getItem('theme') ||
                (prefersDarkScheme.matches ? 'dark' : 'light');

            // Aplicar tema inicial
            if (currentTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.classList.replace('fa-moon', 'fa-sun');
            }

            // Cambiar tema al hacer clic
            themeToggle.addEventListener('click', () => {
                const isDark = document.body.getAttribute('data-theme') === 'dark';

                if (isDark) {
                    document.body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                    themeIcon.classList.replace('fa-sun', 'fa-moon');
                } else {
                    document.body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                    themeIcon.classList.replace('fa-moon', 'fa-sun');
                }

                // Actualizar los gráficos si están inicializados
                updateChartsTheme();
            });
        }

        // Poblar el datalist de PPU para autocompletado
        function populatePPUDatalist() {
            const datalist = document.getElementById('ppu-list');
            datalist.innerHTML = '';

            fleetData.forEach(bus => {
                const option = document.createElement('option');
                option.value = bus.ppu;
                datalist.appendChild(option);
            });
        }

        // Inicializar sistema de pestañas
        function initializeTabSystem() {
            const tabs = document.querySelectorAll('.tab-item');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remover clase active de todas las pestañas y páginas
                    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

                    // Agregar clase active a la pestaña clickeada
                    tab.classList.add('active');

                    // Mostrar página correspondiente
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId + '-page').classList.add('active');

                    // Actualizar gráficos si estamos en la página de informes
                    if (tabId === 'reports') {
                        updateAllCharts();
                    }
                });
            });
        }

        // Actualizar campo de fecha y hora
        function updateDateTimeField() {
            const now = new Date();
            // Formato para mostrar al usuario
            const formattedDateForDisplay = now.toLocaleString('es-CL');
            // Formato ISO para Supabase
            const formattedDateForDB = now.toISOString();

            // Mostrar formato legible para el usuario
            const fechaElement = document.getElementById('fecha');
            if (fechaElement) {
                fechaElement.value = formattedDateForDisplay;
                // Guardar formato ISO como un atributo de datos
                fechaElement.setAttribute('data-iso-date', formattedDateForDB);
            }
        }

        // Inicializar formulario
        function initializeFormHandling() {
            // Manejar cambios en el campo PPU
            const ppuInput = document.getElementById('ppu');
            if (ppuInput) {
                ppuInput.addEventListener('input', function () {
                    const ppu = this.value.toUpperCase();
                    this.value = ppu; // Convertir a mayúsculas mientras se escribe
                    const bus = fleetData.find(b => b.ppu === ppu);

                    if (bus) {
                        document.getElementById('clase').value = bus.clase;
                        document.getElementById('marca').value = bus.marca;
                        currentBusData = bus;

                        // Si no estamos en modo edición y se selecciona un bus, intentar cargar datos previos
                        if (!isEditMode) {
                            populateNorms();
                            checkExistingInspection(ppu);
                        }
                    } else {
                        document.getElementById('clase').value = '';
                        document.getElementById('marca').value = '';
                        currentBusData = null;
                        clearNorms();
                    }
                });
            }

            // Manejo del envío del formulario
            const inspectionForm = document.getElementById('inspection-form');
            if (inspectionForm) {
                inspectionForm.addEventListener('submit', handleFormSubmit);
            }

            // Funcionalidad para contraer/expandir todas las normas
            const collapseAllBtn = document.getElementById('collapse-all');
            if (collapseAllBtn) {
                collapseAllBtn.addEventListener('click', function () {
                    document.querySelectorAll('.norm-card').forEach(card => {
                        const statusOptions = card.querySelector('.status-options');
                        if (statusOptions && !statusOptions.classList.contains('hidden')) {
                            statusOptions.classList.add('hidden');
                        }
                    });
                });
            }

            const expandAllBtn = document.getElementById('expand-all');
            if (expandAllBtn) {
                expandAllBtn.addEventListener('click', function () {
                    document.querySelectorAll('.norm-card').forEach(card => {
                        const statusOptions = card.querySelector('.status-options');
                        if (statusOptions) {
                            statusOptions.classList.remove('hidden');
                        }
                    });
                });
            }
        }

        // Manejar envío del formulario
        async function handleFormSubmit(e) {
            e.preventDefault();

            if (!currentBusData) {
                showToast('error', 'Error', 'Por favor ingrese una patente válida');
                return;
            }

            // Verificar que todas las normas han sido respondidas
            const unansweredNorms = document.querySelectorAll('.norm-card.unanswered');
            if (unansweredNorms.length > 0) {
                showToast('warning', 'Formulario Incompleto', 'Por favor complete todas las normas antes de enviar');

                // Scroll a la primera norma sin responder
                unansweredNorms[0].scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Resaltar visualmente
                unansweredNorms.forEach(norm => {
                    norm.classList.add('pulse-animation');
                    setTimeout(() => {
                        norm.classList.remove('pulse-animation');
                    }, 2000);
                });

                return;
            }

            // Mostrar cargador
            showLoader('Guardando inspección...');

            try {
                // Crear objeto de datos
                const formData = {
                    ppu: document.getElementById('ppu').value.toUpperCase(),
                    terminal: document.getElementById('terminal').value,
                    clase: document.getElementById('clase').value,
                    marca: document.getElementById('marca').value,
                    fecha: document.getElementById('fecha').value,
                    fechaISO: document.getElementById('fecha').getAttribute('data-iso-date'),
                    observaciones: document.getElementById('observaciones').value,
                    norms: []
                };

                // Recopilar estado de las normas
                document.querySelectorAll('.norm-card').forEach(normItem => {
                    const normTitle = normItem.querySelector('.norm-title').textContent;
                    const selectedOption = normItem.querySelector('.status-option.selected');
                    const status = selectedOption ? selectedOption.getAttribute('data-status') : null;

                    if (status) {
                        formData.norms.push({
                            title: normTitle,
                            status: status
                        });
                    }
                });

                // Guardar o actualizar datos de la inspección
                if (isEditMode && editInspectionIndex >= 0) {
                    await updateInspection(formData, editInspectionIndex);
                    showToast('success', 'Inspección Actualizada', 'Los datos se han actualizado correctamente');
                } else {
                    await saveInspection(formData);
                    showToast('success', 'Inspección Registrada', 'La inspección se ha registrado correctamente');
                }

                // Resetear formulario y estado
                this.reset();
                clearNorms();
                currentBusData = null;
                isEditMode = false;
                editInspectionIndex = -1;

                // Actualizar UI
                await loadInspectionData();
            } catch (error) {
                console.error('Error al procesar la inspección:', error);
                showToast('error', 'Error', 'Ocurrió un problema al guardar la inspección');
            } finally {
                hideLoader();
            }
        }

        // Verificar si existe una inspección previa
        async function checkExistingInspection(ppu) {
            showLoader('Verificando registros previos...');

            try {
                let existingInspection = null;

                if (isConnected && supabaseClient) {
                    // Buscar en Supabase
                    const { data, error } = await supabaseClient
                        .from('inspecciones')
                        .select('*')
                        .eq('ppu', ppu)
                        .order('fecha', { ascending: false })
                        .limit(1);

                    if (error) throw error;

                    if (data && data.length > 0) {
                        const inspectionId = data[0].id;

                        // Obtener normas asociadas
                        const { data: normsData, error: normsError } = await supabaseClient
                            .from('normas_inspeccion')
                            .select('*')
                            .eq('inspeccion_id', inspectionId);

                        if (normsError) throw normsError;

                        existingInspection = {
                            ...data[0],
                            norms: normsData.map(n => ({
                                title: n.titulo,
                                status: n.estado
                            }))
                        };
                    }
                } else {
                    // Buscar en datos locales
                    const busInspections = inspectionData.filter(insp => insp.ppu === ppu);
                    if (busInspections.length > 0) {
                        // Ordenar por fecha descendente para obtener la más reciente
                        busInspections.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                        existingInspection = busInspections[0];
                    }
                }

                // Si encontramos una inspección existente
                if (existingInspection) {
                    hideLoader();

                    // NUEVA FUNCIÓN: Verificar si el bus está pendiente de revisión
                    const pendingNorms = existingInspection.norms.filter(norm =>
                        norm.status === 'Pendiente' || norm.status === 'Dañada'
                    );

                    // Si no hay normas pendientes, alertar que ya está completamente revisado
                    if (pendingNorms.length === 0) {
                        showToast('info', 'Bus Completamente Revisado',
                            'Este bus ya ha sido inspeccionado y no tiene normas pendientes. ¿Desea revisarlo nuevamente?',
                            true, () => {
                                loadExistingInspection(ppu);
                            });
                    } else {
                        // Si hay normas pendientes, alertar cuántas normas pendientes hay
                        showToast('warning', 'Bus con Pendientes',
                            `Este bus tiene ${pendingNorms.length} normas pendientes o dañadas. ¿Desea continuar la revisión?`,
                            true, () => {
                                loadExistingInspection(ppu);
                            });
                    }
                } else {
                    hideLoader();
                }
            } catch (error) {
                console.error('Error al verificar inspección existente:', error);
                hideLoader();
            }
        }

        // Inicializar modales
        function initializeModals() {
            // Modal de detalles
            const detailModalBackdrop = document.getElementById('detail-modal-backdrop');
            const detailModalClose = document.getElementById('modal-close');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalEditBtn = document.getElementById('modal-edit-btn');
            const modalPrintBtn = document.getElementById('modal-print-btn');

            // Cerrar modal al hacer clic en el botón de cierre
            if (detailModalClose) {
                detailModalClose.addEventListener('click', closeDetailModal);
            }

            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', closeDetailModal);
            }

            // Cerrar modal al hacer clic fuera
            if (detailModalBackdrop) {
                detailModalBackdrop.addEventListener('click', function (e) {
                    if (e.target === detailModalBackdrop) {
                        closeDetailModal();
                    }
                });
            }

            // Funcionalidad del botón de edición
            if (modalEditBtn) {
                modalEditBtn.addEventListener('click', function () {
                    const ppu = document.querySelector('#modal-title').textContent.split(':')[1].trim();
                    loadExistingInspection(ppu);
                    closeDetailModal();
                    // Cambiar a la pestaña del formulario
                    document.querySelector('.tab-item[data-tab="form"]').click();
                });
            }

            if (modalPrintBtn) {
                modalPrintBtn.addEventListener('click', function () {
                    window.print();
                });
            }

            // Modal de imágenes
            const imageModalBackdrop = document.getElementById('image-modal-backdrop');
            const imageModalClose = document.getElementById('image-modal-close');
            const imageModalCloseBtn = document.getElementById('image-modal-close-btn');

            // Cerrar modal al hacer clic en el botón de cierre
            if (imageModalClose) {
                imageModalClose.addEventListener('click', closeImageModal);
            }

            if (imageModalCloseBtn) {
                imageModalCloseBtn.addEventListener('click', closeImageModal);
            }

            // Cerrar modal al hacer clic fuera
            if (imageModalBackdrop) {
                imageModalBackdrop.addEventListener('click', function (e) {
                    if (e.target === imageModalBackdrop) {
                        closeImageModal();
                    }
                });
            }
        }

        // Inicializar vista previa de imágenes
        function initializeImagePreview() {
            // La funcionalidad se agregará dinámicamente al crear las tarjetas de normas
        }

        // Inicializar filtros
        function initializeFilters() {
            // Filtros del historial
            const historySearch = document.getElementById('history-search');
            if (historySearch) {
                historySearch.addEventListener('input', function () {
                    currentPage.history = 1;
                    updateHistoryList();
                });
            }

            const historyFilter = document.getElementById('history-filter');
            if (historyFilter) {
                historyFilter.addEventListener('change', function () {
                    currentPage.history = 1;
                    updateHistoryList();
                });
            }

            // Filtros de buses completos
            const completeSearch = document.getElementById('complete-search');
            if (completeSearch) {
                completeSearch.addEventListener('input', function () {
                    currentPage.complete = 1;
                    updateCompleteList();
                });
            }

            const completeFilter = document.getElementById('complete-filter');
            if (completeFilter) {
                completeFilter.addEventListener('change', function () {
                    currentPage.complete = 1;
                    updateCompleteList();
                });
            }

            // Filtros de buses pendientes
            const pendingSearch = document.getElementById('pending-search');
            if (pendingSearch) {
                pendingSearch.addEventListener('input', function () {
                    currentPage.pending = 1;
                    updatePendingList();
                });
            }

            const pendingFilter = document.getElementById('pending-filter');
            if (pendingFilter) {
                pendingFilter.addEventListener('change', function () {
                    currentPage.pending = 1;
                    updatePendingList();
                });
            }
        }

        // Inicializar botones de exportación
        function initializeExportButtons() {
            const exportPdfBtn = document.getElementById('export-pdf');
            if (exportPdfBtn) {
                exportPdfBtn.addEventListener('click', exportToPDF);
            }

            const exportExcelBtn = document.getElementById('export-excel');
            if (exportExcelBtn) {
                exportExcelBtn.addEventListener('click', exportToExcel);
            }

            const sendReportBtn = document.getElementById('send-report');
            if (sendReportBtn) {
                sendReportBtn.addEventListener('click', sendEmailReport);
            }

            const generateCompleteReportBtn = document.getElementById('generate-complete-report');
            if (generateCompleteReportBtn) {
                generateCompleteReportBtn.addEventListener('click', generateCompleteReport);
            }

            const exportChartsBtn = document.getElementById('export-charts');
            if (exportChartsBtn) {
                exportChartsBtn.addEventListener('click', exportCharts);
            }
        }

        // Inicializar funcionalidad de impresión
        function initializePrintFunctionality() {
            const modalPrintBtn = document.getElementById('modal-print-btn');
            if (modalPrintBtn) {
                modalPrintBtn.addEventListener('click', function () {
                    window.print();
                });
            }
        }

        // Inicializar gráficos
        function initializeCharts() {
            // Se inicializan al cargar los datos
        }

        // Poblar normas en el formulario
        function populateNorms() {
            const normsContainer = document.getElementById('norms-container');
            if (!normsContainer) return;

            normsContainer.innerHTML = '';

            graphicsNorms.forEach((norm, index) => {
                const normCard = document.createElement('div');
                normCard.className = 'norm-card unanswered';
                normCard.setAttribute('data-norm-index', index);

                const normHeader = document.createElement('div');
                normHeader.className = 'norm-header';

                const normTitle = document.createElement('div');
                normTitle.className = 'norm-title';
                normTitle.textContent = norm.title;

                const normActions = document.createElement('div');
                normActions.className = 'norm-actions';

                const infoButton = document.createElement('button');
                infoButton.className = 'btn-icon';
                infoButton.title = 'Ver descripción';
                infoButton.innerHTML = '<i class="fas fa-info-circle"></i>';
                infoButton.addEventListener('click', function () {
                    showToast('info', norm.title, norm.description);
                });

                const imageButton = document.createElement('button');
                imageButton.className = 'btn-icon';
                imageButton.title = 'Ver imagen de referencia';
                imageButton.innerHTML = '<i class="fas fa-image"></i>';
                imageButton.addEventListener('click', function () {
                    showImagePreview(norm.title, `./assets/normas/${norm.title.toLowerCase().replace(/\s+/g, '-')}.jpg`, norm.description);
                });

                normActions.appendChild(infoButton);
                normActions.appendChild(imageButton);

                normHeader.appendChild(normTitle);
                normHeader.appendChild(normActions);

                const statusOptions = document.createElement('div');
                statusOptions.className = 'status-options';

                // Crear opciones de estado
                statusOptions.innerHTML = `
            <div class="status-option" data-status="Instalada"><i class="fas fa-check"></i> Instalada</div>
            <div class="status-option" data-status="Pendiente"><i class="fas fa-clock"></i> Pendiente</div>
            <div class="status-option" data-status="Dañada"><i class="fas fa-exclamation-triangle"></i> Dañada</div>
            <div class="status-option" data-status="No Corresponde"><i class="fas fa-ban"></i> No Aplica</div>
        `;

                normCard.appendChild(normHeader);
                normCard.appendChild(statusOptions);

                // Agregar evento para contraer/expandir
                normHeader.addEventListener('click', function (e) {
                    if (!e.target.closest('.btn-icon')) {
                        statusOptions.classList.toggle('hidden');
                    }
                });

                // Agregar funcionalidad a las opciones de estado
                statusOptions.querySelectorAll('.status-option').forEach(option => {
                    option.addEventListener('click', function () {
                        // Remover selección previa
                        statusOptions.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('selected'));

                        // Marcar como seleccionada
                        this.classList.add('selected');

                        // Actualizar estado del norm-card
                        normCard.classList.remove('unanswered', 'installed', 'pending', 'damaged', 'not-applicable');

                        const status = this.getAttribute('data-status');
                        switch (status) {
                            case 'Instalada':
                                normCard.classList.add('installed');
                                break;
                            case 'Pendiente':
                                normCard.classList.add('pending');
                                break;
                            case 'Dañada':
                                normCard.classList.add('damaged');
                                break;
                            case 'No Corresponde':
                                normCard.classList.add('not-applicable');
                                break;
                        }
                    });
                });

                normsContainer.appendChild(normCard);
            });
        }

        // Limpiar contenedor de normas
        function clearNorms() {
            const normsContainer = document.getElementById('norms-container');
            if (normsContainer) {
                normsContainer.innerHTML = '';
            }
        }

        // Mostrar vista previa de imagen
        function showImagePreview(title, imageSrc, description) {
            const imageModal = document.getElementById('image-modal-backdrop');
            const modalTitle = document.getElementById('image-modal-title');
            const previewImage = document.getElementById('preview-image');
            const imageCaption = document.getElementById('image-caption');

            if (!imageModal || !modalTitle || !previewImage || !imageCaption) return;

            modalTitle.textContent = title;
            previewImage.src = imageSrc || 'assets/placeholder.jpg';
            previewImage.alt = `Imagen de referencia: ${title}`;
            imageCaption.textContent = description || 'Imagen de referencia para la norma gráfica.';

            // Fallback para imágenes que no existan
            previewImage.onerror = function () {
                this.src = 'assets/placeholder.jpg';
            };

            imageModal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Evitar scroll
        }

        // Cerrar modal de imagen
        function closeImageModal() {
            const imageModal = document.getElementById('image-modal-backdrop');
            if (imageModal) {
                imageModal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Guardar inspección
        async function saveInspection(data) {
            if (isConnected && supabaseClient) {
                try {
                    // 1. Guardar inspección principal
                    const { data: inspectionData, error: inspectionError } = await supabaseClient
                        .from('inspecciones')
                        .insert([{
                            ppu: data.ppu,
                            terminal: data.terminal,
                            clase: data.clase,
                            marca: data.marca,
                            fecha: data.fechaISO,
                            fecha_display: data.fecha,
                            observaciones: data.observaciones
                        }])
                        .select();

                    if (inspectionError) throw inspectionError;

                    if (!inspectionData || inspectionData.length === 0) {
                        throw new Error('No se recibieron datos de la inspección guardada');
                    }

                    const savedInspection = inspectionData[0];

                    // 2. Guardar detalles de normas
                    const normPromises = data.norms.map(norm => {
                        return supabaseClient
                            .from('normas_inspeccion')
                            .insert([{
                                inspeccion_id: savedInspection.id,
                                titulo: norm.title,
                                estado: norm.status
                            }]);
                    });

                    await Promise.all(normPromises);

                    // Actualizar datos en memoria
                    await loadInspectionData();

                } catch (error) {
                    console.error('Error al guardar en Supabase:', error);
                    throw error;
                }
            } else {
                // Modo offline: Guardar en localStorage
                data.id = Date.now(); // Generar ID temporal
                data.created_at = new Date().toISOString();

                // Comprobar si ya existe un registro para este bus
                const existingIndex = inspectionData.findIndex(insp => insp.ppu === data.ppu);

                if (existingIndex >= 0) {
                    // Actualizar registro existente
                    inspectionData[existingIndex] = data;
                } else {
                    // Agregar nuevo registro
                    inspectionData.push(data);
                }

                // Guardar en localStorage
                localStorage.setItem('inspections', JSON.stringify(inspectionData));
            }
        }

        // Actualizar inspección existente
        async function updateInspection(data, index) {
            if (isConnected && supabaseClient) {
                try {
                    // Obtener ID de la inspección
                    const { data: existingData, error: fetchError } = await supabaseClient
                        .from('inspecciones')
                        .select('id')
                        .eq('ppu', data.ppu)
                        .limit(1);

                    if (fetchError) throw fetchError;

                    if (!existingData || existingData.length === 0) {
                        throw new Error(`No se encontró la inspección para el PPU ${data.ppu}`);
                    }

                    const inspectionId = existingData[0].id;

                    // Actualizar inspección principal
                    const { error: updateError } = await supabaseClient
                        .from('inspecciones')
                        .update({
                            terminal: data.terminal,
                            clase: data.clase,
                            marca: data.marca,
                            fecha: data.fechaISO,
                            fecha_display: data.fecha,
                            observaciones: data.observaciones
                        })
                        .eq('id', inspectionId);

                    if (updateError) throw updateError;

                    // Eliminar normas existentes
                    const { error: deleteError } = await supabaseClient
                        .from('normas_inspeccion')
                        .delete()
                        .eq('inspeccion_id', inspectionId);

                    if (deleteError) throw deleteError;

                    // Insertar nuevas normas
                    const normPromises = data.norms.map(norm => {
                        return supabaseClient
                            .from('normas_inspeccion')
                            .insert([{
                                inspeccion_id: inspectionId,
                                titulo: norm.title,
                                estado: norm.status
                            }]);
                    });

                    await Promise.all(normPromises);

                    // Actualizar datos en memoria
                    await loadInspectionData();

                } catch (error) {
                    console.error('Error al actualizar en Supabase:', error);
                    throw error;
                }
            } else {
                // Modo offline: Actualizar en localStorage
                inspectionData[index] = data;
                localStorage.setItem('inspections', JSON.stringify(inspectionData));
            }
        }

        // Cargar datos de inspección
        async function loadInspectionData() {
            showLoader('Cargando datos...');

            try {
                if (isConnected && supabaseClient) {
                    // 1. Obtener inspecciones
                    const { data: inspections, error: inspectionsError } = await supabaseClient
                        .from('inspecciones')
                        .select('*')
                        .order('fecha', { ascending: false });

                    if (inspectionsError) throw inspectionsError;

                    // 2. Obtener normas para cada inspección
                    const inspectionsWithNorms = await Promise.all(
                        inspections.map(async (inspection) => {
                            try {
                                const { data: norms, error: normsError } = await supabaseClient
                                    .from('normas_inspeccion')
                                    .select('*')
                                    .eq('inspeccion_id', inspection.id);

                                if (normsError) throw normsError;

                                return {
                                    ...inspection,
                                    norms: norms.map(n => ({
                                        title: n.titulo,
                                        status: n.estado
                                    }))
                                };
                            } catch (error) {
                                console.error(`Error al cargar normas para inspección ${inspection.id}:`, error);
                                return {
                                    ...inspection,
                                    norms: []
                                };
                            }
                        })
                    );

                    // Actualizar datos en memoria
                    inspectionData = inspectionsWithNorms;

                    // Guardar copia en localStorage por si perdemos conexión
                    localStorage.setItem('inspections_backup', JSON.stringify(inspectionsWithNorms));

                } else {
                    // Modo offline: Cargar desde localStorage
                    loadFromLocalStorage();
                }

                // Actualizar UI
                updateUI();

            } catch (error) {
                console.error('Error al cargar datos:', error);
                // Si falla, intentar cargar desde localStorage
                loadFromLocalStorage();
            } finally {
                hideLoader();
            }
        }

        // Cargar datos desde localStorage
        function loadFromLocalStorage() {
            // Primero intentar cargar desde inspections
            let storedInspections = localStorage.getItem('inspections');

            if (!storedInspections) {
                // Si no hay datos en inspections, intentar con el backup
                storedInspections = localStorage.getItem('inspections_backup');
            }

            inspectionData = storedInspections ? JSON.parse(storedInspections) : [];
        }

        // Actualizar toda la UI
        function updateUI() {
            updateHistoryList();
            updateCompleteList();
            updatePendingList();
            updateCounters();
            updateAllCharts();
        }

        // Actualizar lista del historial
        function updateHistoryList() {
            const historyList = document.getElementById('history-list');
            const emptyState = document.getElementById('history-empty');

            if (!historyList || !emptyState) return;

            const searchTerm = document.getElementById('history-search')?.value.toLowerCase() || '';
            const filterValue = document.getElementById('history-filter')?.value || 'all';

            // Aplicar filtros
            let filteredInspections = inspectionData;

            if (searchTerm) {
                filteredInspections = filteredInspections.filter(insp =>
                    insp.ppu.toLowerCase().includes(searchTerm)
                );
            }

            if (filterValue !== 'all') {
                filteredInspections = filteredInspections.filter(insp => {
                    const pendingNorms = insp.norms.filter(norm => norm.status === 'Pendiente').length;
                    const damagedNorms = insp.norms.filter(norm => norm.status === 'Dañada').length;

                    if (filterValue === 'completed') {
                        return pendingNorms === 0 && damagedNorms === 0;
                    } else if (filterValue === 'pending') {
                        return pendingNorms > 0;
                    } else if (filterValue === 'damaged') {
                        return damagedNorms > 0;
                    }
                    return true;
                });
            }

            // Mostrar estado vacío si no hay inspecciones
            if (filteredInspections.length === 0) {
                historyList.innerHTML = '';
                emptyState.style.display = 'block';
                updatePagination('history', 0, 1);
                return;
            }

            // Calcular paginación
            const totalPages = Math.ceil(filteredInspections.length / PAGE_SIZE);
            if (currentPage.history > totalPages) {
                currentPage.history = 1;
            }

            const startIndex = (currentPage.history - 1) * PAGE_SIZE;
            const endIndex = startIndex + PAGE_SIZE;
            const paginatedInspections = filteredInspections.slice(startIndex, endIndex);

            // Ocultar estado vacío y actualizar lista
            emptyState.style.display = 'none';
            historyList.innerHTML = '';

            paginatedInspections.forEach((inspection, index) => {
                const pendingNorms = inspection.norms.filter(norm => norm.status === 'Pendiente').length;
                const damagedNorms = inspection.norms.filter(norm => norm.status === 'Dañada').length;

                let status = 'Completo';
                let statusClass = 'badge-success';

                if (pendingNorms > 0) {
                    status = `Pendiente (${pendingNorms})`;
                    statusClass = 'badge-warning';
                } else if (damagedNorms > 0) {
                    status = `Con Daños (${damagedNorms})`;
                    statusClass = 'badge-danger';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${inspection.fecha_display || new Date(inspection.fecha).toLocaleString('es-CL')}</td>
            <td>${inspection.ppu}</td>
            <td>${inspection.terminal}</td>
            <td><span class="badge ${statusClass}"><i class="${statusClass === 'badge-success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'}"></i> ${status}</span></td>
            <td class="table-action-cell">
                <button class="btn-icon view-inspection" data-ppu="${inspection.ppu}" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon edit-inspection" data-ppu="${inspection.ppu}" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
            </td>
        `;
                historyList.appendChild(row);
            });

            // Actualizar paginación
            updatePagination('history', filteredInspections.length, currentPage.history);

            // Agregar eventos a los botones
            document.querySelectorAll('.view-inspection').forEach(btn => {
                btn.addEventListener('click', function () {
                    const ppu = this.getAttribute('data-ppu');
                    const inspection = inspectionData.find(insp => insp.ppu === ppu);
                    if (inspection) {
                        showInspectionDetails(inspection);
                    }
                });
            });

            document.querySelectorAll('.edit-inspection').forEach(btn => {
                btn.addEventListener('click', function () {
                    const ppu = this.getAttribute('data-ppu');
                    loadExistingInspection(ppu);
                    document.querySelector('.tab-item[data-tab="form"]').click();
                });
            });
        }

        // Actualizar lista de buses completos
        function updateCompleteList() {
            const completeList = document.getElementById('complete-buses-list');
            const emptyState = document.getElementById('complete-empty');

            if (!completeList || !emptyState) return;

            const searchTerm = document.getElementById('complete-search')?.value.toLowerCase() || '';
            const filterValue = document.getElementById('complete-filter')?.value || 'all';

            // Obtener buses completos
            const completeBuses = getCompleteBuses();

            // Aplicar filtros
            let filteredBuses = completeBuses;

            if (searchTerm) {
                filteredBuses = filteredBuses.filter(bus =>
                    bus.ppu.toLowerCase().includes(searchTerm)
                );
            }

            if (filterValue !== 'all') {
                filteredBuses = filteredBuses.filter(bus => bus.marca === filterValue);
            }

            // Mostrar estado vacío si no hay buses
            if (filteredBuses.length === 0) {
                completeList.innerHTML = '';
                emptyState.style.display = 'block';
                updatePagination('complete', 0, 1);
                return;
            }

            // Calcular paginación
            const totalPages = Math.ceil(filteredBuses.length / PAGE_SIZE);
            if (currentPage.complete > totalPages) {
                currentPage.complete = 1;
            }

            const startIndex = (currentPage.complete - 1) * PAGE_SIZE;
            const endIndex = startIndex + PAGE_SIZE;
            const paginatedBuses = filteredBuses.slice(startIndex, endIndex);

            // Ocultar estado vacío y actualizar lista
            emptyState.style.display = 'none';
            completeList.innerHTML = '';

            paginatedBuses.forEach(bus => {
                const busItem = document.createElement('li');
                busItem.className = 'bus-item complete';
                busItem.setAttribute('data-ppu', bus.ppu);

                const installedCount = bus.norms.filter(norm => norm.status === 'Instalada').length;
                const naCount = bus.norms.filter(norm => norm.status === 'No Corresponde').length;

                busItem.innerHTML = `
            <div class="bus-info">
                <div class="bus-ppu">${bus.ppu}</div>
                <div class="bus-details">
                    <span class="bus-detail-item"><i class="fas fa-truck"></i> ${bus.marca}</span>
                    <span class="bus-detail-item"><i class="fas fa-tag"></i> Clase ${bus.clase}</span>
                    <span class="bus-detail-item"><i class="fas fa-warehouse"></i> ${bus.terminal}</span>
                </div>
            </div>
            <div class="bus-status">
                <span class="badge badge-success"><i class="fas fa-check-circle"></i> Completo</span>
            </div>
        `;

                completeList.appendChild(busItem);

                // Agregar evento de clic para mostrar detalles
                busItem.addEventListener('click', function () {
                    const ppu = this.getAttribute('data-ppu');
                    const busInspection = inspectionData.find(insp => insp.ppu === ppu);
                    if (busInspection) {
                        showInspectionDetails(busInspection);
                    }
                });
            });

            // Actualizar paginación
            updatePagination('complete', filteredBuses.length, currentPage.complete);
        }

        // Actualizar lista de buses pendientes
        function updatePendingList() {
            const pendingList = document.getElementById('pending-list');
            const emptyState = document.getElementById('pending-empty');

            if (!pendingList || !emptyState) return;

            const searchTerm = document.getElementById('pending-search')?.value.toLowerCase() || '';
            const filterValue = document.getElementById('pending-filter')?.value || 'all';

            // Obtener buses pendientes
            const pendingBuses = getPendingBuses();

            // Aplicar filtros
            let filteredBuses = pendingBuses;

            if (searchTerm) {
                filteredBuses = filteredBuses.filter(bus =>
                    bus.ppu.toLowerCase().includes(searchTerm)
                );
            }

            if (filterValue !== 'all') {
                filteredBuses = filteredBuses.filter(bus => {
                    if (filterValue === 'class-b') {
                        return bus.clase === 'B';
                    } else if (filterValue === 'class-c') {
                        return bus.clase === 'C';
                    }
                    return true;
                });
            }

            // Mostrar estado vacío si no hay buses
            if (filteredBuses.length === 0) {
                pendingList.innerHTML = '';
                emptyState.style.display = 'block';
                updatePagination('pending', 0, 1);
                return;
            }

            // Calcular paginación
            const totalPages = Math.ceil(filteredBuses.length / PAGE_SIZE);
            if (currentPage.pending > totalPages) {
                currentPage.pending = 1;
            }

            const startIndex = (currentPage.pending - 1) * PAGE_SIZE;
            const endIndex = startIndex + PAGE_SIZE;
            const paginatedBuses = filteredBuses.slice(startIndex, endIndex);

            // Ocultar estado vacío y actualizar lista
            emptyState.style.display = 'none';
            pendingList.innerHTML = '';

            paginatedBuses.forEach(item => {
                const statusClass = item.status === 'Pendiente' ? 'badge-warning' : 'badge-danger';
                const statusIcon = item.status === 'Pendiente' ? 'clock' : 'exclamation-triangle';

                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${item.ppu}</td>
            <td>${item.clase}</td>
            <td>${item.normTitle}</td>
            <td><span class="badge ${statusClass}"><i class="fas fa-${statusIcon}"></i> ${item.status}</span></td>
            <td class="table-action-cell">
                <button class="btn-icon view-bus" data-ppu="${item.ppu}" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon edit-bus" data-ppu="${item.ppu}" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
            </td>
        `;
                pendingList.appendChild(row);
            });

            // Actualizar paginación
            updatePagination('pending', filteredBuses.length, currentPage.pending);

            // Agregar eventos a los botones
            document.querySelectorAll('.view-bus, .edit-bus').forEach(btn => {
                btn.addEventListener('click', function () {
                    const ppu = this.getAttribute('data-ppu');
                    const busInspection = inspectionData.find(insp => insp.ppu === ppu);

                    if (busInspection) {
                        if (this.classList.contains('view-bus')) {
                            showInspectionDetails(busInspection);
                        } else {
                            loadExistingInspection(ppu);
                            document.querySelector('.tab-item[data-tab="form"]').click();
                        }
                    }
                });
            });
        }

        // Actualizar paginación
        function updatePagination(type, totalItems, currentPageNum) {
            const paginationContainer = document.getElementById(`${type}-pagination`);
            if (!paginationContainer) return;

            const totalPages = Math.ceil(totalItems / PAGE_SIZE);

            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // Botón anterior
            paginationHTML += `
        <li class="page-item ${currentPageNum === 1 ? 'disabled' : ''}">
            <button class="page-link" data-page="${currentPageNum - 1}" ${currentPageNum === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>
        </li>
    `;

            // Determinar qué páginas mostrar
            let startPage = Math.max(1, currentPageNum - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            // Primera página
            if (startPage > 1) {
                paginationHTML += `
            <li class="page-item">
                <button class="page-link" data-page="1">1</button>
            </li>
        `;

                if (startPage > 2) {
                    paginationHTML += `
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            `;
                }
            }

            // Páginas numéricas
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
            <li class="page-item ${i === currentPageNum ? 'active' : ''}">
                <button class="page-link" data-page="${i}">${i}</button>
            </li>
        `;
            }

            // Última página
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            `;
                }

                paginationHTML += `
            <li class="page-item">
                <button class="page-link" data-page="${totalPages}">${totalPages}</button>
            </li>
        `;
            }

            // Botón siguiente
            paginationHTML += `
        <li class="page-item ${currentPageNum === totalPages ? 'disabled' : ''}">
            <button class="page-link" data-page="${currentPageNum + 1}" ${currentPageNum === totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>
        </li>
    `;

            paginationContainer.innerHTML = paginationHTML;

            // Agregar eventos a los botones de paginación
            paginationContainer.querySelectorAll('.page-link:not([disabled])').forEach(btn => {
                btn.addEventListener('click', function () {
                    const pageNum = parseInt(this.getAttribute('data-page'));
                    currentPage[type] = pageNum;

                    // Actualizar la lista correspondiente
                    if (type === 'history') {
                        updateHistoryList();
                    } else if (type === 'complete') {
                        updateCompleteList();
                    } else if (type === 'pending') {
                        updatePendingList();
                    }
                });
            });
        }

        // Obtener buses completos
        function getCompleteBuses() {
            // Considerar cada bus solo una vez (la inspección más reciente)
            const processedBuses = new Set();
            const completeBuses = [];

            // Ordenar por fecha descendente para tener las inspecciones más recientes primero
            const sortedInspections = [...inspectionData].sort((a, b) =>
                new Date(b.fecha) - new Date(a.fecha)
            );

            sortedInspections.forEach(inspection => {
                // Si ya procesamos este bus, saltarlo
                if (processedBuses.has(inspection.ppu)) return;

                const pendingNorms = inspection.norms.filter(norm =>
                    norm.status === 'Pendiente' || norm.status === 'Dañada'
                );

                if (pendingNorms.length === 0) {
                    completeBuses.push(inspection);
                }

                // Marcar como procesado
                processedBuses.add(inspection.ppu);
            });

            return completeBuses;
        }

        // Obtener buses pendientes
        function getPendingBuses() {
            const pendingItems = [];
            const processedBuses = new Set();

            // Ordenar por fecha descendente
            const sortedInspections = [...inspectionData].sort((a, b) =>
                new Date(b.fecha) - new Date(a.fecha)
            );

            sortedInspections.forEach(inspection => {
                // Si ya procesamos este bus, saltarlo
                if (processedBuses.has(inspection.ppu)) return;

                const pendingNorms = inspection.norms.filter(norm =>
                    norm.status === 'Pendiente'
                );

                const damagedNorms = inspection.norms.filter(norm =>
                    norm.status === 'Dañada'
                );

                if (pendingNorms.length > 0 || damagedNorms.length > 0) {
                    // Agregar elementos pendientes
                    pendingNorms.forEach(norm => {
                        pendingItems.push({
                            ppu: inspection.ppu,
                            clase: inspection.clase,
                            marca: inspection.marca,
                            terminal: inspection.terminal,
                            normTitle: norm.title,
                            status: norm.status
                        });
                    });

                    // Agregar elementos dañados
                    damagedNorms.forEach(norm => {
                        pendingItems.push({
                            ppu: inspection.ppu,
                            clase: inspection.clase,
                            marca: inspection.marca,
                            terminal: inspection.terminal,
                            normTitle: norm.title,
                            status: norm.status
                        });
                    });

                    // Marcar como procesado
                    processedBuses.add(inspection.ppu);
                }
            });

            return pendingItems;
        }

        // Actualizar contadores
        function updateCounters() {
            const completeBuses = getCompleteBuses().length;
            const pendingBuses = new Set(getPendingBuses()
                .filter(item => item.status === 'Pendiente')
                .map(item => item.ppu)).size;

            const damagedBuses = new Set(getPendingBuses()
                .filter(item => item.status === 'Dañada')
                .map(item => item.ppu)).size;

            const totalInspections = new Set(inspectionData.map(item => item.ppu)).size;

            // Actualizar contadores en UI
            const completedCountElement = document.getElementById('completed-count');
            if (completedCountElement) completedCountElement.textContent = completeBuses;

            const pendingCountElement = document.getElementById('pending-count');
            if (pendingCountElement) pendingCountElement.textContent = pendingBuses;

            const damagedCountElement = document.getElementById('damaged-count');
            if (damagedCountElement) damagedCountElement.textContent = damagedBuses;

            const totalCountElement = document.getElementById('total-count');
            if (totalCountElement) totalCountElement.textContent = totalInspections;
        }

        // Mostrar detalles de inspección en modal
        function showInspectionDetails(inspection) {
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalBackdrop = document.getElementById('detail-modal-backdrop');

            if (!modalTitle || !modalBody || !modalBackdrop) return;

            modalTitle.innerHTML = `<i class="fas fa-bus"></i> Bus: ${inspection.ppu}`;

            // Crear el contenido del modal
            let content = `
    <div class="bus-summary print-include">
        <div class="summary-header">
            <h3 class="summary-title"><i class="fas fa-info-circle"></i> Información General</h3>
            <div class="summary-date">Última inspección: ${inspection.fecha_display || new Date(inspection.fecha).toLocaleString('es-CL')}</div>
        </div>
        
        <div class="summary-info">
            <div class="summary-item">
                <div class="summary-label">Terminal</div>
                <div class="summary-value">${inspection.terminal}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Clase</div>
                <div class="summary-value">${inspection.clase}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Marca</div>
                <div class="summary-value">${inspection.marca}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Observaciones</div>
                <div class="summary-value">${inspection.observaciones || 'Sin observaciones'}</div>
            </div>
        </div>
    `;

            // Estadísticas de normas
            const installedNorms = inspection.norms.filter(norm => norm.status === 'Instalada');
            const pendingNorms = inspection.norms.filter(norm => norm.status === 'Pendiente');
            const damagedNorms = inspection.norms.filter(norm => norm.status === 'Dañada');
            const notApplicableNorms = inspection.norms.filter(norm => norm.status === 'No Corresponde');

            content += `
        <div class="status-chart">
            <div class="status-stats">
                <div class="status-stat-item installed-stat">
                    <div class="status-stat-value">${installedNorms.length}</div>
                    <div class="status-stat-label">Instaladas</div>
                </div>
                <div class="status-stat-item pending-stat">
                    <div class="status-stat-value">${pendingNorms.length}</div>
                    <div class="status-stat-label">Pendientes</div>
                </div>
                <div class="status-stat-item damaged-stat">
                    <div class="status-stat-value">${damagedNorms.length}</div>
                    <div class="status-stat-label">Dañadas</div>
                </div>
                <div class="status-stat-item not-applicable-stat">
                    <div class="status-stat-value">${notApplicableNorms.length}</div>
                    <div class="status-stat-label">No Aplica</div>
                </div>
            </div>
            <canvas id="modal-chart" width="400" height="200"></canvas>
        </div>
    `;

            // Lista de normas agrupadas por estado
            content += `
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Estado de Normas Gráficas</h3>
        </div>
        
        <div class="card" style="margin-top: 1rem;">
            <div class="card-header">
                <h4 class="card-title"><i class="fas fa-check"></i> Normas Instaladas (${installedNorms.length})</h4>
            </div>
            <div class="card-body">
                <ul class="norms-status-list">
                    ${installedNorms.map(norm => `
                        <li class="norm-status-item">
                            <span class="norm-status-name">${norm.title}</span>
                            <span class="badge badge-success"><i class="fas fa-check"></i> Instalada</span>
                        </li>
                    `).join('')}
                    ${installedNorms.length === 0 ? '<li class="norm-status-item">No hay normas instaladas</li>' : ''}
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h4 class="card-title"><i class="fas fa-clock"></i> Normas Pendientes (${pendingNorms.length})</h4>
            </div>
            <div class="card-body">
                <ul class="norms-status-list">
                    ${pendingNorms.map(norm => `
                        <li class="norm-status-item">
                            <span class="norm-status-name">${norm.title}</span>
                            <span class="badge badge-warning"><i class="fas fa-clock"></i> Pendiente</span>
                        </li>
                    `).join('')}
                    ${pendingNorms.length === 0 ? '<li class="norm-status-item">No hay normas pendientes</li>' : ''}
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h4 class="card-title"><i class="fas fa-exclamation-triangle"></i> Normas Dañadas (${damagedNorms.length})</h4>
            </div>
            <div class="card-body">
                <ul class="norms-status-list">
                    ${damagedNorms.map(norm => `
                        <li class="norm-status-item">
                            <span class="norm-status-name">${norm.title}</span>
                            <span class="badge badge-danger"><i class="fas fa-exclamation-triangle"></i> Dañada</span>
                        </li>
                    `).join('')}
                    ${damagedNorms.length === 0 ? '<li class="norm-status-item">No hay normas dañadas</li>' : ''}
                </ul>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h4 class="card-title"><i class="fas fa-ban"></i> Normas No Aplicables (${notApplicableNorms.length})</h4>
            </div>
            <div class="card-body">
                <ul class="norms-status-list">
                    ${notApplicableNorms.map(norm => `
                        <li class="norm-status-item">
                            <span class="norm-status-name">${norm.title}</span>
                            <span class="badge badge-secondary"><i class="fas fa-ban"></i> No Aplica</span>
                        </li>
                    `).join('')}
                    ${notApplicableNorms.length === 0 ? '<li class="norm-status-item">No hay normas no aplicables</li>' : ''}
                </ul>
            </div>
        </div>
    </div>
    `;

            modalBody.innerHTML = content;

            // Mostrar el modal
            modalBackdrop.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevenir scroll

            // Renderizar gráfico
            renderModalChart({
                installed: installedNorms.length,
                pending: pendingNorms.length,
                damaged: damagedNorms.length,
                notApplicable: notApplicableNorms.length
            });
        }

        // Renderizar gráfico en el modal
        function renderModalChart(data) {
            const canvas = document.getElementById('modal-chart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
            const textColor = isDarkMode ? '#e2e8f0' : '#1e293b';

            if (window.modalChart) {
                window.modalChart.destroy();
            }

            window.modalChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Instaladas', 'Pendientes', 'Dañadas', 'No Aplica'],
                    datasets: [{
                        data: [data.installed, data.pending, data.damaged, data.notApplicable],
                        backgroundColor: [
                            '#10b981', // success
                            '#ef4444', // danger
                            '#f59e0b', // warning
                            '#94a3b8'  // gray
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: textColor,
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: isDarkMode ? '#1e293b' : '#ffffff',
                            titleColor: textColor,
                            bodyColor: textColor,
                            borderColor: isDarkMode ? '#475569' : '#e2e8f0',
                            borderWidth: 1,
                            bodyFont: {
                                family: "'Inter', sans-serif"
                            },
                            titleFont: {
                                family: "'Inter', sans-serif",
                                weight: 'bold'
                            },
                            boxPadding: 10
                        }
                    }
                }
            });
        }

        // Cerrar modal de detalles
        function closeDetailModal() {
            const modalBackdrop = document.getElementById('detail-modal-backdrop');
            if (modalBackdrop) {
                modalBackdrop.style.display = 'none';
                document.body.style.overflow = ''; // Restaurar scroll
            }

            // Destruir gráfico
            if (window.modalChart) {
                window.modalChart.destroy();
                window.modalChart = null;
            }
        }

        // Cargar una inspección existente para edición
        function loadExistingInspection(ppu) {
            // Encontrar la inspección más reciente para este bus
            const inspections = inspectionData.filter(insp => insp.ppu === ppu);

            if (inspections.length === 0) return;

            // Ordenar por fecha descendente
            inspections.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            const inspection = inspections[0];

            // Establecer modo edición
            isEditMode = true;
            editInspectionIndex = inspectionData.indexOf(inspection);

            // Llenar campos del formulario
            document.getElementById('ppu').value = inspection.ppu;
            document.getElementById('terminal').value = inspection.terminal;
            document.getElementById('clase').value = inspection.clase;
            document.getElementById('marca').value = inspection.marca;
            document.getElementById('observaciones').value = inspection.observaciones || '';

            // Asegurar que tenemos los datos del bus
            currentBusData = fleetData.find(bus => bus.ppu === inspection.ppu) || {
                ppu: inspection.ppu,
                clase: inspection.clase,
                marca: inspection.marca
            };

            // Poblar normas
            populateNorms();

            // Seleccionar las opciones previamente guardadas
            setTimeout(() => {
                document.querySelectorAll('.norm-card').forEach(normCard => {
                    const normTitle = normCard.querySelector('.norm-title').textContent;
                    const norm = inspection.norms.find(n => n.title === normTitle);

                    if (norm) {
                        const statusOption = normCard.querySelector(`.status-option[data-status="${norm.status}"]`);
                        if (statusOption) {
                            statusOption.click();
                        }
                    }
                });
            }, 100);

            // Mostrar un mensaje de modo edición
            showToast('info', 'Modo Edición', `Editando inspección de ${ppu}. Complete el formulario y guarde los cambios.`);
        }

        // Mostrar loader
        function showLoader(message = 'Procesando...') {
            const loader = document.getElementById('loader');
            const loaderText = document.querySelector('.loader-text');

            if (!loader) return;

            if (loaderText) {
                loaderText.textContent = message;
            }

            loader.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevenir scroll
        }

        // Ocultar loader
        function hideLoader() {
            const loader = document.getElementById('loader');
            if (loader) {
                loader.style.display = 'none';
                document.body.style.overflow = ''; // Restaurar scroll
            }
        }

        // Mostrar toast
        function showToast(type, title, message, autoHide = true, callback = null) {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;

            const toastId = 'toast-' + Date.now();

            // Crear elemento toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;

            // Icono según tipo
            let iconClass = 'fa-info-circle';
            if (type === 'success') iconClass = 'fa-check-circle';
            else if (type === 'error') iconClass = 'fa-times-circle';
            else if (type === 'warning') iconClass = 'fa-exclamation-triangle';

            toast.innerHTML = `
        <div class="toast-icon">
            <i class="fas ${iconClass}"></i>
        </div>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <div class="toast-actions">
            <button class="toast-close" aria-label="Cerrar">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;

            toastContainer.appendChild(toast);

            // Mostrar el toast (con delay para la animación)
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // Agregar evento de click
            if (callback) {
                toast.addEventListener('click', function (e) {
                    if (!e.target.closest('.toast-close')) {
                        callback();
                        closeToast(toastId);
                    }
                });

                // Cambiar cursor para indicar que es clickeable
                toast.style.cursor = 'pointer';
            }

            // Agregar evento para cerrar
            toast.querySelector('.toast-close').addEventListener('click', function () {
                closeToast(toastId);
            });

            // Auto ocultar después de 5 segundos
            if (autoHide) {
                setTimeout(() => {
                    closeToast(toastId);
                }, 5000);
            }
        }

        // Cerrar toast específico
        function closeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (!toast) return;

            toast.classList.remove('show');

            setTimeout(() => {
                toast.remove();
            }, 500);
        }

        // Exportar a PDF
        function exportToPDF() {
            const pendingBuses = getPendingBuses();

            if (pendingBuses.length === 0) {
                showToast('warning', 'Sin Datos', 'No hay buses pendientes para exportar');
                return;
            }

            showLoader('Generando PDF...');

            setTimeout(() => {
                try {
                    // Crear PDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');

                    // Configurar título
                    doc.setFontSize(18);
                    doc.setTextColor(0, 102, 255);
                    doc.setFont(undefined, 'bold');
                    doc.text('Reporte de Buses Pendientes', 150, 15, { align: 'center' });

                    // Agregar fecha
                    doc.setFontSize(11);
                    doc.setTextColor(100, 100, 100);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Fecha de Generación: ${new Date().toLocaleDateString('es-CL')} ${new Date().toLocaleTimeString('es-CL')}`, 150, 22, { align: 'center' });

                    // Agregar estadísticas
                    const uniqueBuses = new Set(pendingBuses.map(b => b.ppu)).size;
                    const pendingCount = pendingBuses.filter(b => b.status === 'Pendiente').length;
                    const damagedCount = pendingBuses.filter(b => b.status === 'Dañada').length;

                    doc.setFontSize(10);
                    doc.setTextColor(40, 40, 40);
                    doc.text(`Total de Buses Pendientes: ${uniqueBuses}`, 20, 30);
                    doc.text(`Normas Pendientes: ${pendingCount}`, 20, 36);
                    doc.text(`Normas Dañadas: ${damagedCount}`, 20, 42);

                    // Preparar datos de la tabla
                    const tableHeaders = [['PPU', 'Clase', 'Marca', 'Terminal', 'Norma Pendiente', 'Estado']];
                    const tableData = pendingBuses.map(item => [
                        item.ppu,
                        item.clase,
                        item.marca,
                        item.terminal,
                        item.normTitle,
                        item.status
                    ]);

                    // Generar tabla
                    doc.autoTable({
                        head: tableHeaders,
                        body: tableData,
                        startY: 50,
                        headStyles: {
                            fillColor: [0, 102, 255],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [240, 240, 240]
                        },
                        columnStyles: {
                            0: { cellWidth: 25 },
                            1: { cellWidth: 20 },
                            2: { cellWidth: 25 },
                            3: { cellWidth: 35 },
                            4: { cellWidth: 80 },
                            5: { cellWidth: 25 }
                        },
                        margin: { top: 50 }
                    });

                    // Agregar pie de página
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(150, 150, 150);
                        doc.text(`Sistema de Inspección - Red Movilidad | Página ${i} de ${pageCount}`, 150, doc.internal.pageSize.height - 10, { align: 'center' });
                    }

                    // Guardar PDF
                    doc.save(`buses-pendientes_${new Date().toISOString().split('T')[0]}.pdf`);

                    showToast('success', 'PDF Generado', 'El archivo PDF se ha descargado correctamente');
                } catch (error) {
                    console.error('Error al generar PDF:', error);
                    showToast('error', 'Error', 'No se pudo generar el PDF. Inténtelo nuevamente.');
                } finally {
                    hideLoader();
                }
            }, 500);
        }

        // Exportar a Excel
        function exportToExcel() {
            const pendingBuses = getPendingBuses();

            if (pendingBuses.length === 0) {
                showToast('warning', 'Sin Datos', 'No hay buses pendientes para exportar');
                return;
            }

            showLoader('Generando Excel...');

            setTimeout(() => {
                try {
                    // Preparar datos
                    const data = [
                        ['PPU', 'Clase', 'Marca', 'Terminal', 'Norma Pendiente', 'Estado', 'Fecha Inspección']
                    ];

                    pendingBuses.forEach(item => {
                        const inspection = inspectionData.find(insp => insp.ppu === item.ppu);
                        const fecha = inspection ? (inspection.fecha_display || new Date(inspection.fecha).toLocaleString('es-CL')) : '';

                        data.push([
                            item.ppu,
                            item.clase,
                            item.marca,
                            item.terminal,
                            item.normTitle,
                            item.status,
                            fecha
                        ]);
                    });

                    // Crear hoja resumen
                    const uniqueBuses = Array.from(new Set(pendingBuses.map(item => item.ppu)));
                    const summaryData = [
                        ['Resumen de Buses Pendientes'],
                        ['Total Buses Pendientes', uniqueBuses.length],
                        ['Total Normas Pendientes', pendingBuses.filter(item => item.status === 'Pendiente').length],
                        ['Total Normas Dañadas', pendingBuses.filter(item => item.status === 'Dañada').length],
                        [''],
                        ['Buses Pendientes por Clase'],
                        ['Clase B', pendingBuses.filter(item => item.clase === 'B').length],
                        ['Clase C', pendingBuses.filter(item => item.clase === 'C').length],
                        [''],
                        ['Buses Pendientes por Marca'],
                        ['Scania', uniqueBuses.filter(ppu =>
                            pendingBuses.find(item => item.ppu === ppu && item.marca === 'Scania')
                        ).length],
                        ['Volvo', uniqueBuses.filter(ppu =>
                            pendingBuses.find(item => item.ppu === ppu && item.marca === 'Volvo')
                        ).length]
                    ];

                    // Crear libro de trabajo
                    const wb = XLSX.utils.book_new();

                    // Agregar hoja de datos
                    const wsData = XLSX.utils.aoa_to_sheet(data);
                    XLSX.utils.book_append_sheet(wb, wsData, 'Detalle');

                    // Agregar hoja de resumen
                    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
                    XLSX.utils.book_append_sheet(wb, wsSummary, 'Resumen');

                    // Establecer anchos de columna para la hoja de datos
                    wsData['!cols'] = [
                        { wch: 10 },  // PPU
                        { wch: 10 },  // Clase
                        { wch: 15 },  // Marca
                        { wch: 20 },  // Terminal
                        { wch: 40 },  // Norma
                        { wch: 15 },  // Estado
                        { wch: 20 }   // Fecha
                    ];

                    // Guardar archivo
                    XLSX.writeFile(wb, `buses-pendientes_${new Date().toISOString().split('T')[0]}.xlsx`);

                    showToast('success', 'Excel Generado', 'El archivo Excel se ha descargado correctamente');
                } catch (error) {
                    console.error('Error al generar Excel:', error);
                    showToast('error', 'Error', 'No se pudo generar el Excel. Inténtelo nuevamente.');
                } finally {
                    hideLoader();
                }
            }, 500);
        }

        // Enviar informe por email (simulado)
        function sendEmailReport() {
            showLoader('Preparando informe...');

            setTimeout(() => {
                showToast('success', 'Informe Enviado', 'El informe ha sido enviado por correo electrónico correctamente.');
                hideLoader();
            }, 1500);
        }

        // Generar informe completo (simulado)
        function generateCompleteReport() {
            showLoader('Generando informe completo...');

            setTimeout(() => {
                showToast('success', 'Informe Generado', 'El informe completo ha sido generado y descargado correctamente.');
                hideLoader();
            }, 2000);
        }

        // Exportar gráficos (simulado)
        function exportCharts() {
            showLoader('Exportando gráficos...');

            setTimeout(() => {
                showToast('success', 'Gráficos Exportados', 'Los gráficos han sido exportados correctamente.');
                hideLoader();
            }, 1500);
        }

        // Actualizar gráfico con el tema actual
        function updateChartsTheme() {
            // Actualizar gráficos si existen
            updateAllCharts();

            // Actualizar gráfico del modal si está visible
            if (document.getElementById('detail-modal-backdrop')?.style.display === 'flex' && window.modalChart) {
                const chartData = window.modalChart.data.datasets[0].data;
                renderModalChart({
                    installed: chartData[0],
                    pending: chartData[1],
                    damaged: chartData[2],
                    notApplicable: chartData[3]
                });
            }
        }

        // Inicializar y actualizar todos los gráficos
        function updateAllCharts() {
            if (!document.getElementById('fleet-status-chart')) return;

            const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
            const textColor = isDarkMode ? '#e2e8f0' : '#1e293b';

            // Fuente común para todos los gráficos
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = textColor;

            // Estilo común para todos los gráficos
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            font: {
                                family: "'Inter', sans-serif"
                            },
                            color: textColor
                        }
                    },
                    tooltip: {
                        backgroundColor: isDarkMode ? '#1e293b' : '#ffffff',
                        titleColor: textColor,
                        bodyColor: textColor,
                        borderColor: isDarkMode ? '#475569' : '#e2e8f0',
                        borderWidth: 1,
                        bodyFont: {
                            family: "'Inter', sans-serif"
                        },
                        titleFont: {
                            family: "'Inter', sans-serif",
                            weight: 'bold'
                        },
                        boxPadding: 10
                    }
                }
            };

            // 1. Gráfico de Estado General de la Flota
            const completeBuses = getCompleteBuses().length;
            const pendingBusesUnique = new Set(getPendingBuses().filter(item => item.status === 'Pendiente').map(item => item.ppu)).size;
            const damagedBusesUnique = new Set(getPendingBuses().filter(item => item.status === 'Dañada').map(item => item.ppu)).size;

            if (window.fleetStatusChart) {
                window.fleetStatusChart.destroy();
            }

            window.fleetStatusChart = new Chart(
                document.getElementById('fleet-status-chart').getContext('2d'),
                {
                    type: 'doughnut',
                    data: {
                        labels: ['Completos', 'Pendientes', 'Con Daños'],
                        datasets: [{
                            data: [completeBuses, pendingBusesUnique, damagedBusesUnique],
                            backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...commonOptions,
                        cutout: '60%'
                    }
                }
            );

            // 2. Top 5 Normas Pendientes
            const normCounts = {};
            getPendingBuses().forEach(item => {
                if (!normCounts[item.normTitle]) {
                    normCounts[item.normTitle] = 0;
                }
                normCounts[item.normTitle]++;
            });

            const sortedNorms = Object.entries(normCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            if (window.pendingNormsChart) {
                window.pendingNormsChart.destroy();
            }

            window.pendingNormsChart = new Chart(
                document.getElementById('pending-norms-chart').getContext('2d'),
                {
                    type: 'bar',
                    data: {
                        labels: sortedNorms.map(norm => norm[0]),
                        datasets: [{
                            label: 'Cantidad',
                            data: sortedNorms.map(norm => norm[1]),
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                }
                            },
                            x: {
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                }
                            }
                        }
                    }
                }
            );

            // 3. Progreso por Terminal
            const terminalStats = {};

            // Inicializar con todos los terminales
            const terminals = ['EL ROBLE', 'LA REINA', 'MARIA ANGELICA', 'EL DESCANSO'];
            terminals.forEach(terminal => {
                terminalStats[terminal] = {
                    complete: 0,
                    pending: 0,
                    damaged: 0
                };
            });

            // Contar buses completos por terminal
            getCompleteBuses().forEach(bus => {
                if (terminalStats[bus.terminal]) {
                    terminalStats[bus.terminal].complete++;
                }
            });

            // Contar buses pendientes y dañados por terminal
            const pendingByTerminal = new Map();
            const damagedByTerminal = new Map();

            getPendingBuses().forEach(item => {
                if (item.status === 'Pendiente') {
                    pendingByTerminal.set(item.terminal, (pendingByTerminal.get(item.terminal) || new Set()).add(item.ppu));
                } else if (item.status === 'Dañada') {
                    damagedByTerminal.set(item.terminal, (damagedByTerminal.get(item.terminal) || new Set()).add(item.ppu));
                }
            });

            terminals.forEach(terminal => {
                terminalStats[terminal].pending = pendingByTerminal.has(terminal) ? pendingByTerminal.get(terminal).size : 0;
                terminalStats[terminal].damaged = damagedByTerminal.has(terminal) ? damagedByTerminal.get(terminal).size : 0;
            });

            if (window.terminalProgressChart) {
                window.terminalProgressChart.destroy();
            }

            window.terminalProgressChart = new Chart(
                document.getElementById('terminal-progress-chart').getContext('2d'),
                {
                    type: 'bar',
                    data: {
                        labels: terminals,
                        datasets: [
                            {
                                label: 'Completos',
                                data: terminals.map(t => terminalStats[t].complete),
                                backgroundColor: '#10b981',
                                borderColor: '#059669',
                                borderWidth: 1
                            },
                            {
                                label: 'Pendientes',
                                data: terminals.map(t => terminalStats[t].pending),
                                backgroundColor: '#ef4444',
                                borderColor: '#b91c1c',
                                borderWidth: 1
                            },
                            {
                                label: 'Con Daños',
                                data: terminals.map(t => terminalStats[t].damaged),
                                backgroundColor: '#f59e0b',
                                borderColor: '#d97706',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            y: {
                                beginAtZero: true,
                                stacked: true,
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                }
                            },
                            x: {
                                stacked: true,
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                }
                            }
                        }
                    }
                }
            );

            // 4. Comparativa por Clase de Bus
            const classStats = {
                'B': { complete: 0, pending: 0, damaged: 0 },
                'C': { complete: 0, pending: 0, damaged: 0 }
            };

            // Contar buses completos por clase
            getCompleteBuses().forEach(bus => {
                if (classStats[bus.clase]) {
                    classStats[bus.clase].complete++;
                }
            });

            // Contar buses pendientes y dañados por clase
            const pendingByClass = new Map();
            const damagedByClass = new Map();

            getPendingBuses().forEach(item => {
                if (item.status === 'Pendiente') {
                    pendingByClass.set(item.clase, (pendingByClass.get(item.clase) || new Set()).add(item.ppu));
                } else if (item.status === 'Dañada') {
                    damagedByClass.set(item.clase, (damagedByClass.get(item.clase) || new Set()).add(item.ppu));
                }
            });

            Object.keys(classStats).forEach(clase => {
                classStats[clase].pending = pendingByClass.has(clase) ? pendingByClass.get(clase).size : 0;
                classStats[clase].damaged = damagedByClass.has(clase) ? damagedByClass.get(clase).size : 0;
            });

            if (window.classComparisonChart) {
                window.classComparisonChart.destroy();
            }

            window.classComparisonChart = new Chart(
                document.getElementById('class-comparison-chart').getContext('2d'),
                {
                    type: 'radar',
                    data: {
                        labels: ['Completos', 'Pendientes', 'Con Daños'],
                        datasets: [
                            {
                                label: 'Clase B',
                                data: [
                                    classStats['B'].complete,
                                    classStats['B'].pending,
                                    classStats['B'].damaged
                                ],
                                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                borderColor: '#3b82f6',
                                pointBackgroundColor: '#3b82f6',
                                borderWidth: 2
                            },
                            {
                                label: 'Clase C',
                                data: [
                                    classStats['C'].complete,
                                    classStats['C'].pending,
                                    classStats['C'].damaged
                                ],
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                borderColor: '#10b981',
                                pointBackgroundColor: '#10b981',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            r: {
                                angleLines: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                },
                                grid: {
                                    color: isDarkMode ? '#475569' : '#e2e8f0'
                                },
                                pointLabels: {
                                    color: textColor
                                },
                                ticks: {
                                    backdropColor: 'transparent',
                                    color: textColor
                                }
                            }
                        }
                    }
                }
            );
        }

        // Datos de la flota
        const fleetData = [
            { ppu: "LXWP57", marca: "Scania", clase: "B" },
            { ppu: "LXWP58", marca: "Scania", clase: "C" },
            { ppu: "LXWP59", marca: "Scania", clase: "C" },
            { ppu: "LXWP60", marca: "Scania", clase: "C" },
            { ppu: "LXWP61", marca: "Scania", clase: "B" },
            { ppu: "LXWP62", marca: "Scania", clase: "B" },
            { ppu: "LXWP64", marca: "Scania", clase: "C" },
            { ppu: "LXWP65", marca: "Scania", clase: "C" },
            { ppu: "LXWP66", marca: "Scania", clase: "B" },
            { ppu: "LXWP67", marca: "Scania", clase: "B" },
            { ppu: "LXWP68", marca: "Scania", clase: "B" },
            { ppu: "LXWP69", marca: "Scania", clase: "B" },
            { ppu: "LXWP70", marca: "Scania", clase: "B" },
            { ppu: "LXWP71", marca: "Scania", clase: "B" },
            { ppu: "LXWP72", marca: "Scania", clase: "B" },
            { ppu: "LXWP73", marca: "Scania", clase: "B" },
            { ppu: "LXWP74", marca: "Scania", clase: "B" },
            { ppu: "LXWP75", marca: "Scania", clase: "B" },
            { ppu: "LXWP76", marca: "Scania", clase: "B" },
            { ppu: "LXWP77", marca: "Scania", clase: "B" },
            { ppu: "LXWP78", marca: "Scania", clase: "B" },
            { ppu: "LXWP79", marca: "Scania", clase: "B" },
            { ppu: "LXWP80", marca: "Scania", clase: "B" },
            { ppu: "LXWP81", marca: "Scania", clase: "B" },
            { ppu: "LXWP82", marca: "Scania", clase: "B" },
            { ppu: "LXWP83", marca: "Scania", clase: "B" },
            { ppu: "LXWP85", marca: "Scania", clase: "B" },
            { ppu: "LXWP86", marca: "Scania", clase: "B" },
            { ppu: "LXWP87", marca: "Scania", clase: "C" },
            { ppu: "PFTV77", marca: "Scania", clase: "B" },
            { ppu: "PFTW19", marca: "Scania", clase: "C" },
            { ppu: "PFTW20", marca: "Scania", clase: "C" },
            { ppu: "PFTW25", marca: "Scania", clase: "C" },
            { ppu: "PFTW26", marca: "Scania", clase: "C" },
            { ppu: "PFTW28", marca: "Scania", clase: "B" },
            { ppu: "PFTW29", marca: "Scania", clase: "B" },
            { ppu: "PFTW30", marca: "Scania", clase: "B" },
            { ppu: "PFTW31", marca: "Scania", clase: "B" },
            { ppu: "PFTW32", marca: "Scania", clase: "B" },
            { ppu: "PFTW34", marca: "Scania", clase: "B" },
            { ppu: "PFTW35", marca: "Scania", clase: "C" },
            { ppu: "PFTW36", marca: "Scania", clase: "B" },
            { ppu: "PFTW38", marca: "Scania", clase: "B" },
            { ppu: "PFTW39", marca: "Scania", clase: "C" },
            { ppu: "PFTW40", marca: "Scania", clase: "B" },
            { ppu: "PFTW41", marca: "Scania", clase: "C" },
            { ppu: "PFTW42", marca: "Scania", clase: "C" },
            { ppu: "PFTW44", marca: "Scania", clase: "B" },
            { ppu: "PFTW45", marca: "Scania", clase: "B" },
            { ppu: "PFTW46", marca: "Scania", clase: "B" },
            { ppu: "PFTW47", marca: "Scania", clase: "B" },
            { ppu: "PFTW48", marca: "Scania", clase: "C" },
            { ppu: "PFTW49", marca: "Scania", clase: "B" },
            { ppu: "PFTW50", marca: "Scania", clase: "B" },
            { ppu: "PFTW51", marca: "Scania", clase: "C" },
            { ppu: "PFTW55", marca: "Scania", clase: "C" },
            { ppu: "PFTW56", marca: "Scania", clase: "B" },
            { ppu: "PFTW57", marca: "Scania", clase: "B" },
            { ppu: "PFTW58", marca: "Scania", clase: "B" },
            { ppu: "PFTW59", marca: "Scania", clase: "C" },
            { ppu: "PFTW60", marca: "Scania", clase: "C" },
            { ppu: "PFTW61", marca: "Scania", clase: "C" },
            { ppu: "PFTW62", marca: "Scania", clase: "C" },
            { ppu: "PFVG75", marca: "Scania", clase: "C" },
            { ppu: "PFVG76", marca: "Scania", clase: "C" },
            { ppu: "PFVG77", marca: "Scania", clase: "C" },
            { ppu: "PFVG78", marca: "Scania", clase: "B" },
            { ppu: "PFVG79", marca: "Scania", clase: "B" },
            { ppu: "PFVG80", marca: "Scania", clase: "B" },
            { ppu: "PFVG82", marca: "Scania", clase: "B" },
            { ppu: "PFVG83", marca: "Scania", clase: "B" },
            { ppu: "PFVG85", marca: "Scania", clase: "B" },
            { ppu: "PFVG86", marca: "Scania", clase: "B" },
            { ppu: "PFVG87", marca: "Scania", clase: "B" },
            { ppu: "PFVG88", marca: "Scania", clase: "B" },
            { ppu: "PFVG89", marca: "Scania", clase: "C" },
            { ppu: "PFVG90", marca: "Scania", clase: "C" },
            { ppu: "PFVG92", marca: "Scania", clase: "C" },
            { ppu: "PFVG93", marca: "Scania", clase: "C" },
            { ppu: "PFVG94", marca: "Scania", clase: "C" },
            { ppu: "PFVG95", marca: "Scania", clase: "C" },
            { ppu: "PFVG96", marca: "Scania", clase: "C" },
            { ppu: "PFVG97", marca: "Scania", clase: "B" },
            { ppu: "PFVG98", marca: "Scania", clase: "B" },
            { ppu: "PFVG99", marca: "Scania", clase: "B" },
            { ppu: "PFVH10", marca: "Scania", clase: "B" },
            { ppu: "PFVH11", marca: "Scania", clase: "B" },
            { ppu: "PFVH12", marca: "Scania", clase: "B" },
            { ppu: "PFVH13", marca: "Scania", clase: "B" },
            { ppu: "PFVH14", marca: "Scania", clase: "B" },
            { ppu: "PFVH15", marca: "Scania", clase: "B" },
            { ppu: "PFYC13", marca: "Scania", clase: "C" },
            { ppu: "PFYC14", marca: "Scania", clase: "C" },
            { ppu: "PFYC16", marca: "Scania", clase: "C" },
            { ppu: "PFYC17", marca: "Scania", clase: "C" },
            { ppu: "PFYC19", marca: "Scania", clase: "B" },
            { ppu: "PFYC20", marca: "Scania", clase: "B" },
            { ppu: "PFYC25", marca: "Scania", clase: "B" },
            { ppu: "PFYC26", marca: "Scania", clase: "C" },
            { ppu: "PFYC27", marca: "Scania", clase: "B" },
            { ppu: "PFYC28", marca: "Scania", clase: "B" },
            { ppu: "PFYC29", marca: "Scania", clase: "B" },
            { ppu: "PFYC31", marca: "Scania", clase: "B" },
            { ppu: "PFYC32", marca: "Scania", clase: "B" },
            { ppu: "PFYC33", marca: "Scania", clase: "B" },
            { ppu: "PFYC34", marca: "Scania", clase: "B" },
            { ppu: "PFYC35", marca: "Scania", clase: "B" },
            { ppu: "PFYC36", marca: "Scania", clase: "B" },
            { ppu: "PFYC37", marca: "Scania", clase: "C" },
            { ppu: "PFYC43", marca: "Scania", clase: "B" },
            { ppu: "PFYC44", marca: "Scania", clase: "B" },
            { ppu: "PFYC46", marca: "Scania", clase: "C" },
            { ppu: "PFYC49", marca: "Scania", clase: "B" },
            { ppu: "PFYC50", marca: "Scania", clase: "C" },
            { ppu: "PFYC53", marca: "Scania", clase: "B" },
            { ppu: "PFYC55", marca: "Scania", clase: "B" },
            { ppu: "PFYC57", marca: "Scania", clase: "B" },
            { ppu: "PFYC58", marca: "Scania", clase: "C" },
            { ppu: "PFYC59", marca: "Scania", clase: "C" },
            { ppu: "PFYC60", marca: "Scania", clase: "B" },
            { ppu: "PFYC61", marca: "Scania", clase: "C" },
            { ppu: "PFYC62", marca: "Scania", clase: "C" },
            { ppu: "PFYC63", marca: "Scania", clase: "C" },
            { ppu: "PFYC64", marca: "Scania", clase: "C" },
            { ppu: "PFYC65", marca: "Scania", clase: "B" },
            { ppu: "PFYC66", marca: "Scania", clase: "B" },
            { ppu: "PFYC68", marca: "Scania", clase: "C" },
            { ppu: "PFYC69", marca: "Scania", clase: "C" },
            { ppu: "PFYC70", marca: "Scania", clase: "C" },
            { ppu: "PFYC72", marca: "Scania", clase: "B" },
            { ppu: "PFYC75", marca: "Scania", clase: "B" },
            { ppu: "PFYC76", marca: "Scania", clase: "B" },
            { ppu: "PFYC77", marca: "Scania", clase: "B" },
            { ppu: "PFYC79", marca: "Scania", clase: "C" },
            { ppu: "PFYC80", marca: "Scania", clase: "C" },
            { ppu: "PFYC81", marca: "Scania", clase: "C" },
            { ppu: "PFYC82", marca: "Scania", clase: "C" },
            { ppu: "PFYC85", marca: "Scania", clase: "C" },
            { ppu: "PFYC88", marca: "Scania", clase: "B" },
            { ppu: "PFYC90", marca: "Scania", clase: "B" },
            { ppu: "PFZK83", marca: "Scania", clase: "C" },
            { ppu: "PFZK85", marca: "Scania", clase: "C" },
            { ppu: "PFZK87", marca: "Scania", clase: "C" },
            { ppu: "PFZK88", marca: "Scania", clase: "C" },
            { ppu: "PFZK91", marca: "Scania", clase: "C" },
            { ppu: "PGBF42", marca: "Scania", clase: "C" },
            { ppu: "PGBF59", marca: "Scania", clase: "C" },
            { ppu: "PGBY47", marca: "Scania", clase: "C" },
            { ppu: "PGBY52", marca: "Scania", clase: "C" },
            { ppu: "PGBY55", marca: "Scania", clase: "C" },
            { ppu: "PGBY56", marca: "Scania", clase: "C" },
            { ppu: "PGBY67", marca: "Scania", clase: "B" },
            { ppu: "PGBY72", marca: "Scania", clase: "C" },
            { ppu: "PGBY73", marca: "Scania", clase: "C" },
            { ppu: "PGBY83", marca: "Scania", clase: "C" },
            { ppu: "PGKP67", marca: "Scania", clase: "B" },
            { ppu: "PGLD42", marca: "Scania", clase: "B" },
            { ppu: "PGLD67", marca: "Scania", clase: "B" },
            { ppu: "PGLD68", marca: "Scania", clase: "C" },
            { ppu: "PGLD72", marca: "Scania", clase: "C" },
            { ppu: "PGRZ67", marca: "Scania", clase: "B" },
            { ppu: "PGTT95", marca: "Scania", clase: "B" },
            { ppu: "PGTV12", marca: "Scania", clase: "B" },
            { ppu: "PGWT98", marca: "Scania", clase: "B" },
            { ppu: "SHCV78", marca: "Volvo", clase: "B" },
            { ppu: "SHCX39", marca: "Volvo", clase: "B" },
            { ppu: "SHCY22", marca: "Volvo", clase: "B" },
            { ppu: "SHXD75", marca: "Volvo", clase: "B" },
            { ppu: "SHXD77", marca: "Volvo", clase: "B" },
            { ppu: "SHXD79", marca: "Volvo", clase: "B" },
            { ppu: "SHXD85", marca: "Volvo", clase: "B" },
            { ppu: "SHXF13", marca: "Volvo", clase: "B" },
            { ppu: "SHXF14", marca: "Volvo", clase: "B" },
            { ppu: "SHXF29", marca: "Volvo", clase: "B" },
            { ppu: "SHXF31", marca: "Volvo", clase: "B" },
            { ppu: "SHXF84", marca: "Volvo", clase: "B" },
            { ppu: "SHXF85", marca: "Volvo", clase: "B" },
            { ppu: "SHXF87", marca: "Volvo", clase: "B" },
            { ppu: "SHXF88", marca: "Volvo", clase: "B" },
            { ppu: "SHXF90", marca: "Volvo", clase: "B" },
            { ppu: "SHXF92", marca: "Volvo", clase: "B" },
            { ppu: "SHXF93", marca: "Volvo", clase: "B" },
            { ppu: "SHXF97", marca: "Volvo", clase: "B" },
            { ppu: "SHXG36", marca: "Volvo", clase: "B" },
            { ppu: "SHXG38", marca: "Volvo", clase: "B" },
            { ppu: "SJPB21", marca: "Volvo", clase: "B" },
            { ppu: "SJPD42", marca: "Volvo", clase: "B" },
            { ppu: "SJPD44", marca: "Volvo", clase: "B" },
            { ppu: "SJPD71", marca: "Volvo", clase: "B" },
            { ppu: "SJPD72", marca: "Volvo", clase: "B" },
            { ppu: "SKPJ54", marca: "Volvo", clase: "C" },
            { ppu: "SKPJ90", marca: "Volvo", clase: "B" },
            { ppu: "SKPK18", marca: "Volvo", clase: "B" },
            { ppu: "SKPK19", marca: "Volvo", clase: "B" },
            { ppu: "SKPK20", marca: "Volvo", clase: "B" },
            { ppu: "SKPK21", marca: "Volvo", clase: "B" },
            { ppu: "SKPK22", marca: "Volvo", clase: "B" },
            { ppu: "SKPK23", marca: "Volvo", clase: "B" },
            { ppu: "SKPK25", marca: "Volvo", clase: "B" },
            { ppu: "SKPK26", marca: "Volvo", clase: "B" },
            { ppu: "SKPK27", marca: "Volvo", clase: "B" },
            { ppu: "SKPK28", marca: "Volvo", clase: "B" },
            { ppu: "SKPK31", marca: "Volvo", clase: "B" },
            { ppu: "SKPK32", marca: "Volvo", clase: "B" },
            { ppu: "SKPK34", marca: "Volvo", clase: "B" },
            { ppu: "SKPK35", marca: "Volvo", clase: "B" },
            { ppu: "SKPK37", marca: "Volvo", clase: "B" },
            { ppu: "SKPK39", marca: "Volvo", clase: "B" },
            { ppu: "SKPK40", marca: "Volvo", clase: "B" },
            { ppu: "SKPK42", marca: "Volvo", clase: "B" },
            { ppu: "SKPK44", marca: "Volvo", clase: "B" },
            { ppu: "SKPK45", marca: "Volvo", clase: "B" },
            { ppu: "SKPK62", marca: "Volvo", clase: "B" },
            { ppu: "SKPK63", marca: "Volvo", clase: "B" },
            { ppu: "SKPL28", marca: "Volvo", clase: "B" },
            { ppu: "SKPL30", marca: "Volvo", clase: "B" },
            { ppu: "SKPL33", marca: "Volvo", clase: "B" },
            { ppu: "SKPL34", marca: "Volvo", clase: "B" },
            { ppu: "SKPL36", marca: "Volvo", clase: "B" }
        ];

        // Datos de normas gráficas actualizadas
        const graphicsNorms = [
            { title: "CALL CENTER", description: "Información del call center para atención al cliente." },
            { title: "CERO EMISION BUS ELECTRICO", description: "Indicador que identifica buses eléctricos con cero emisiones contaminantes." },
            { title: "NUMERO INTERNO", description: "Identificador numérico interno del bus en la flota." },
            { title: "SEÑAL SUBIDA Y BAJADA", description: "Indicadores que muestran los puntos correctos para subir y bajar del vehículo." },
            { title: "ACCESO SILLA DE RUEDAS", description: "Señalización para acceso y ubicación de personas con movilidad reducida." },
            { title: "VIRAJE AMPLIO", description: "Advertencia sobre el radio de giro amplio que requiere el vehículo." },
            { title: "MARCA CHILE", description: "Logo oficial de la marca país Chile en la carrocería." },
            { title: "REFLECTANTE ESPEJO", description: "Elementos reflectantes de seguridad en espejos del vehículo." },
            { title: "PUNTO CIEGO TRASERO", description: "Señalización relacionada con los puntos ciegos en la parte trasera." },
            { title: "TRIANGULO PUNTO CIEGO", description: "Señalización triangular que advierte sobre los puntos ciegos." },
            { title: "LOGO CLASE A Y B", description: "Identificador visual de buses pertenecientes a las clases A y B." },
            { title: "LOGO CLACE C", description: "Identificador visual de buses pertenecientes a la clase C." },
            { title: "NO SUBIR", description: "Señalización que indica prohibición de subir en determinadas áreas." },
            { title: "CUIDADO APERTURA Y CIERRE DE PUERTAS", description: "Advertencia sobre el sistema automático de apertura y cierre de puertas." },
            { title: "NO TE APOYES", description: "Indicación de no apoyarse en ciertas áreas para evitar accidentes." },
            { title: "PUERTA PARA PERSONAS CON DISCAPACIDAD", description: "Señalización específica de la puerta adaptada para personas con discapacidad." },
            { title: "NO ABRA LA VENTANA", description: "Indicación de ventanas que no deben ser abiertas por seguridad o sistema de climatización." },
            { title: "RANGO DE TEMPERATURA", description: "Información sobre el rango de temperatura del sistema de aire acondicionado." },
            { title: "ESCAPE", description: "Señalización de las salidas de emergencia del vehículo." },
            { title: "INSTRUCCIÓN DE ESCAPE", description: "Instrucciones detalladas para utilizar las salidas de emergencia." },
            { title: "ASIENTO PREFERENTE", description: "Señalización de asientos destinados a personas con necesidades especiales." },
            { title: "ACCESO WIFI", description: "Información sobre la disponibilidad y acceso al servicio WiFi del bus." },
            { title: "LOGO CAMARAS GRABANDO", description: "Aviso que informa sobre la presencia de cámaras de seguridad en funcionamiento." },
            { title: "ADHESIVO ADVERTENCIA FISCALIZACION", description: "Información sobre los procesos de fiscalización del transporte." },
            { title: "ADHESIVO SUBETE AL BUS", description: "Campaña de promoción del uso del transporte público." },
            { title: "ADHESIVO NUMERO DE EMERGENCIA", description: "Número de contacto para situaciones de emergencia durante el viaje." },
            { title: "COMO ACCIONAR FRENO DE MANO ELECTRICO", description: "Instrucciones para operar el freno de mano eléctrico en caso de emergencia." },
            { title: "COMO ACCIONAR FRENO DE MANO", description: "Instrucciones para operar el freno de mano convencional en caso de emergencia." },
            { title: "PERRO DE ASISTENCIA", description: "Señalización sobre el acceso permitido de perros de asistencia o guía." },
            { title: "NO FUMAR", description: "Prohibición de fumar dentro del vehículo según normativa vigente." },
            { title: "PARADA NOCTURNA", description: "Información sobre el servicio de paradas nocturnas a solicitud." },
            { title: "SEÑAL PISO SILLA DE RUEDAS", description: "Señalización en el piso para la correcta ubicación de sillas de ruedas." },
            { title: "CUIDADO PELDAÑO", description: "Advertencia sobre los peldaños de acceso al vehículo." },
            { title: "ESPACIO RESERVADO", description: "Señalización de espacios reservados para diferentes necesidades." },
            { title: "ASIENTO ABATIBLE USO PREFERENTE", description: "Indicación de asientos abatibles reservados para uso preferente." },
            { title: "CENEFA PPU", description: "Elemento decorativo tipo cenefa junto con la Placa Patente Única visible." },
            { title: "SOAP", description: "Información visible del Seguro Obligatorio de Accidentes Personales." },
            { title: "CANAL DE DENUNCIAS", description: "Información sobre los canales oficiales para realizar denuncias." },
            { title: "BUENAS PRACTICAS", description: "Adhesivos informativos sobre buenas prácticas para los usuarios." }
        ];
        // Añadir clase para animar elementos que necesitan atención
        document.head.insertAdjacentHTML('beforeend', `
<style>
    @keyframes pulse-animation {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
        50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
    
    .pulse-animation {
        animation: pulse-animation 1s cubic-bezier(0.24, 0, 0.38, 1) infinite;
    }
</style>
`);


    </script>
</body>

</html>
